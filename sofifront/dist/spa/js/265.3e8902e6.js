"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[265],{59265:(e,t,i)=>{i.r(t),i.d(t,{default:()=>X});var s=i(83673),a=i(62323),l=i(98880);const o=e=>((0,s.dD)("data-v-50dc1749"),e=e(),(0,s.Cn)(),e),n=o((()=>(0,s._)("div",{class:"text-body2"},[(0,s._)("b",null,"Encuesta solo para clientes."),(0,s.Uk)(" Tu respuesta es anónima frente al repartidor. Registramos dominio, IP y navegador solo para verificar autenticidad. ")],-1))),r={class:"row items-center no-wrap"},u={class:"col"},c={key:0},d=(0,s.Uk)(" Sesión iniciada como "),m={class:"text-weight-bold"},g={key:1},h={key:0,class:"col-auto"},p={key:0,class:"q-mb-lg"},f=o((()=>(0,s._)("div",{class:"row items-center no-wrap full-width"},[(0,s._)("img",{class:"g-logo q-mr-sm",alt:"G",src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"}),(0,s._)("div",{class:"col text-center text-weight-medium"},"Continuar con Google")],-1))),w={class:"row no-wrap items-center"},v={class:"col-auto q-pr-md column items-center"},y={class:"bar-wrapper"},_={class:"bar-track"},b={class:"col column justify-around q-gutter-md"},k=(0,s.Uk)("Perfecto!"),q=(0,s.Uk)("¡Todo excelente!"),W=o((()=>(0,s._)("div",{class:"score text-positive"},"10",-1))),x=(0,s.Uk)("Bueno"),C=(0,s.Uk)("Pudo ser mejor"),$=o((()=>(0,s._)("div",{class:"score text-amber-8"},"5",-1))),S=(0,s.Uk)("Malo"),I=(0,s.Uk)("No me gustó"),U=o((()=>(0,s._)("div",{class:"score text-negative"},"0",-1))),Z={key:0,class:"q-mt-sm text-center text-positive"},Q={class:"q-mt-md"},R={key:0,class:"q-mt-sm text-negative text-caption"};function D(e,t,i,o,D,G){const L=(0,s.up)("q-banner"),N=(0,s.up)("q-btn"),j=(0,s.up)("q-icon"),z=(0,s.up)("q-item-section"),T=(0,s.up)("q-item-label"),P=(0,s.up)("q-item"),A=(0,s.up)("q-input"),V=(0,s.up)("q-checkbox"),O=(0,s.up)("q-card"),E=(0,s.up)("q-page"),B=(0,s.up)("q-page-container"),H=(0,s.up)("q-layout"),J=(0,s.Q2)("ripple");return(0,s.wg)(),(0,s.j4)(H,{view:"lhr Lpr lfr",style:{"min-height":"0"}},{default:(0,s.w5)((()=>[(0,s.Wm)(B,null,{default:(0,s.w5)((()=>[(0,s.Wm)(E,{class:"flex flex-center bg-grey-1"},{default:(0,s.w5)((()=>[(0,s.Wm)(O,{class:"enc-card q-pa-md"},{default:(0,s.w5)((()=>[(0,s.Wm)(L,{class:"q-mb-md bg-grey-2",rounded:"",dense:""},{default:(0,s.w5)((()=>[n])),_:1}),(0,s.Wm)(L,{class:(0,a.C_)(["q-mb-md",D.user?"bg-positive text-white":"bg-grey-2"]),rounded:"",dense:""},{default:(0,s.w5)((()=>[(0,s._)("div",r,[(0,s._)("div",u,[D.user?((0,s.wg)(),(0,s.iD)("div",c,[d,(0,s._)("span",m,(0,a.zw)(D.user.email),1)])):((0,s.wg)(),(0,s.iD)("div",g," (Opcional) Inicia sesión con Google para asociar tu correo "))]),D.user?((0,s.wg)(),(0,s.iD)("div",h,[(0,s.Wm)(N,{dense:"",flat:"",icon:"logout",label:"Salir",onClick:G.logout},null,8,["onClick"])])):(0,s.kq)("",!0)])])),_:1},8,["class"]),D.user?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",p,[(0,s.Wm)(N,{class:"btn-google full-width",loading:D.authLoading,onClick:G.loginGoogle,unelevated:""},{default:(0,s.w5)((()=>[f])),_:1},8,["loading","onClick"])])),(0,s._)("div",null,[(0,s._)("div",w,[(0,s._)("div",v,[(0,s.Wm)(j,{name:"add",size:"24px",class:"text-positive q-mb-sm"}),(0,s._)("div",y,[(0,s._)("div",_,[(0,s._)("div",{class:"bar-fill",style:(0,a.j5)({height:G.fillHeight+"%",background:"linear-gradient(180deg, #21ba45 0%, #f2c037 50%, #f44336 100%)"})},null,4)]),(0,s._)("div",{class:"bar-tick",style:(0,a.j5)({bottom:G.fillHeight+"%"})},null,4)])]),(0,s._)("div",b,[(0,s.wy)(((0,s.wg)(),(0,s.j4)(P,{clickable:"",onClick:t[0]||(t[0]=e=>G.select(10)),class:"rounded-md"},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{avatar:""},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{round:"",unelevated:"",size:"lg",color:G.isSel(10)?"positive":"green-5"},{default:(0,s.w5)((()=>[(0,s.Wm)(j,{name:"sentiment_very_satisfied",size:"28px"})])),_:1},8,["color"])])),_:1}),(0,s.Wm)(z,null,{default:(0,s.w5)((()=>[(0,s.Wm)(T,{class:"text-weight-bold"},{default:(0,s.w5)((()=>[k])),_:1}),(0,s.Wm)(T,{caption:""},{default:(0,s.w5)((()=>[q])),_:1})])),_:1}),(0,s.Wm)(z,{side:""},{default:(0,s.w5)((()=>[W])),_:1})])),_:1})),[[J]]),(0,s.wy)(((0,s.wg)(),(0,s.j4)(P,{clickable:"",onClick:t[1]||(t[1]=e=>G.select(5)),class:"rounded-md"},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{avatar:""},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{round:"",unelevated:"",size:"lg",color:G.isSel(5)?"warning":"amber-5"},{default:(0,s.w5)((()=>[(0,s.Wm)(j,{name:"sentiment_neutral",size:"28px"})])),_:1},8,["color"])])),_:1}),(0,s.Wm)(z,null,{default:(0,s.w5)((()=>[(0,s.Wm)(T,{class:"text-weight-bold"},{default:(0,s.w5)((()=>[x])),_:1}),(0,s.Wm)(T,{caption:""},{default:(0,s.w5)((()=>[C])),_:1})])),_:1}),(0,s.Wm)(z,{side:""},{default:(0,s.w5)((()=>[$])),_:1})])),_:1})),[[J]]),(0,s.wy)(((0,s.wg)(),(0,s.j4)(P,{clickable:"",onClick:t[2]||(t[2]=e=>G.select(0)),class:"rounded-md"},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{avatar:""},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{round:"",unelevated:"",size:"lg",color:G.isSel(0)?"negative":"red-5"},{default:(0,s.w5)((()=>[(0,s.Wm)(j,{name:"sentiment_very_dissatisfied",size:"28px"})])),_:1},8,["color"])])),_:1}),(0,s.Wm)(z,null,{default:(0,s.w5)((()=>[(0,s.Wm)(T,{class:"text-weight-bold"},{default:(0,s.w5)((()=>[S])),_:1}),(0,s.Wm)(T,{caption:""},{default:(0,s.w5)((()=>[I])),_:1})])),_:1}),(0,s.Wm)(z,{side:""},{default:(0,s.w5)((()=>[U])),_:1})])),_:1})),[[J]]),(0,s.Wm)(l.uT,{name:"fade"},{default:(0,s.w5)((()=>[D.sent?((0,s.wg)(),(0,s.iD)("div",Z," ¡Gracias por tu respuesta! ✅ ")):(0,s.kq)("",!0)])),_:1})])]),(0,s._)("div",Q,[(0,s.Wm)(A,{modelValue:D.comment,"onUpdate:modelValue":t[3]||(t[3]=e=>D.comment=e),type:"textarea",dense:"",autogrow:"",clearable:"",placeholder:"Comentario (opcional)",disable:D.loading},null,8,["modelValue","disable"]),(0,s.Wm)(V,{modelValue:D.declaroCliente,"onUpdate:modelValue":t[4]||(t[4]=e=>D.declaroCliente=e),disable:D.loading,class:"q-mt-sm",label:"Declaro que soy el cliente titular que recibió el servicio."},null,8,["modelValue","disable"]),(0,s.Wm)(N,{class:"q-mt-sm",color:"primary",label:"Enviar",loading:D.loading,disable:null===D.score||!D.declaroCliente||D.yaRespondio,onClick:G.submit,unelevated:"",rounded:"",icon:"send"},null,8,["loading","disable","onClick"]),D.yaRespondio?((0,s.wg)(),(0,s.iD)("div",R," Ya se registró una respuesta hoy para este cliente y repartidor. ")):(0,s.kq)("",!0)])])])),_:1})])),_:1})])),_:1})])),_:1})}i(92100);const G={name:"EncuestaSatisfaccion",data(){return{idcliente:null,iduser:null,score:null,comment:"",declaroCliente:!1,loading:!1,sent:!1,yaRespondio:!1,user:null,authLoading:!1}},computed:{fillHeight(){return 10===this.score?100:5===this.score?50:(this.score,0)}},async mounted(){if(this.idcliente=Number(this.$route.params.idcliente),this.iduser=Number(this.$route.params.iduser),!this.idcliente||!this.iduser)return void this.$q.notify({type:"negative",message:"URL inválida: faltan parámetros."});const e=localStorage.getItem("enc_user");if(e)try{this.user=JSON.parse(e)}catch(t){}this.$firebase&&(this._unsubAuth=this.$firebase.auth().onAuthStateChanged((async e=>{if(e){const t=await e.getIdToken();this.user={uid:e.uid,email:e.email,name:e.displayName,photo:e.photoURL,idToken:t},localStorage.setItem("enc_user",JSON.stringify(this.user))}else this.user=null,localStorage.removeItem("enc_user")}))),await this.checkDuplicado()},beforeUnmount(){this._unsubAuth&&this._unsubAuth()},methods:{isSel(e){return this.score===e},async select(e){this.score=e},async loginGoogle(){try{if(this.authLoading=!0,this.$loginGoogle)return void await this.$loginGoogle();const e=new this.$firebase.auth.GoogleAuthProvider,t=await this.$firebase.auth().signInWithPopup(e),i=t.user,s=await i.getIdToken();this.user={uid:i.uid,email:i.email,name:i.displayName,photo:i.photoURL,idToken:s},localStorage.setItem("enc_user",JSON.stringify(this.user))}catch(e){console.error(e),this.$q.notify({type:"negative",message:"No se pudo iniciar con Google"})}finally{this.authLoading=!1}},async logout(){try{this.$logout?await this.$logout():await this.$firebase.auth().signOut(),this.user=null,localStorage.removeItem("enc_user")}catch(e){console.error(e)}},async checkDuplicado(){try{const{data:e}=await this.$api.get("encuestas/check",{params:{idcliente:this.idcliente,iduser:this.iduser}});this.yaRespondio=!!e.exists}catch(e){this.$q.notify({type:"warning",message:"No se pudo verificar duplicados."})}},async submit(){if(null!==this.score)if(this.declaroCliente)if(this.yaRespondio)this.$q.notify({type:"negative",message:"Ya existe una respuesta hoy."});else try{var e;this.loading=!0;const t={idcliente:this.idcliente,iduser:this.iduser,score:this.score,comment:this.comment||null,email:(null===(e=this.user)||void 0===e?void 0:e.email)||null,ua:navigator.userAgent};await this.$api.post("encuestas",t),this.sent=!0,this.$q.notify({type:"positive",message:"¡Gracias! Tu respuesta fue enviada."}),this.yaRespondio=!0}catch(s){var t,i;403===(null===s||void 0===s||null===(t=s.response)||void 0===t?void 0:t.status)?this.$q.notify({type:"negative",message:"Solo el cliente puede responder esta encuesta."}):409===(null===s||void 0===s||null===(i=s.response)||void 0===i?void 0:i.status)?(this.$q.notify({type:"warning",message:"Ya se registró una respuesta hoy."}),this.yaRespondio=!0):this.$q.notify({type:"negative",message:"Error al enviar."})}finally{this.loading=!1}else this.$q.notify({type:"warning",message:"Debes declarar que eres el cliente titular."})}}};var L=i(74260),N=i(83066),j=i(72652),z=i(24379),T=i(10151),P=i(15607),A=i(2165),V=i(24554),O=i(83414),E=i(52035),B=i(2350),H=i(64689),J=i(65735),Y=i(46489),M=i(7518),F=i.n(M);const K=(0,L.Z)(G,[["render",D],["__scopeId","data-v-50dc1749"]]),X=K;F()(G,"components",{QLayout:N.Z,QPageContainer:j.Z,QPage:z.Z,QCard:T.Z,QBanner:P.Z,QBtn:A.Z,QIcon:V.Z,QItem:O.Z,QItemSection:E.Z,QItemLabel:B.Z,QInput:H.Z,QCheckbox:J.Z}),F()(G,"directives",{Ripple:Y.Z})}}]);