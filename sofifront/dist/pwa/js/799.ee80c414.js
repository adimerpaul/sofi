"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[799],{96799:(e,t,l)=>{l.r(t),l.d(t,{default:()=>O});l(10071);var a=l(83673),o=l(62323);const s={class:"row q-col-gutter-md q-mb-md"},i={class:"col-12 col-sm-3"},r={class:"col-12 col-sm-3"},n={class:"col-12 col-sm-3"},c={class:"col-12 col-sm-1"},u={class:"col-12 col-sm-2 flex items-center"},d={class:"col-12 col-sm-2"},_={class:"col-12 q-mt-sm"},m={key:0},p={class:"text-left"},h={class:"text-left"},f={class:"text-caption text-grey-7"},w={class:"text-left"},g={class:"text-weight-medium"},v={class:"text-caption text-grey-7"},b={class:"text-caption ellipsis"},x={class:"text-left"},k={class:"text-weight-medium"},y={class:"text-caption text-grey-7"},q={class:"text-caption"},z={class:"text-left"},D={class:"text-left"},C={class:"text-left"},U={class:"text-left"},Y={class:"text-left"},Z={class:"text-caption text-grey-7"},P={class:"text-left"},V={key:1},W={key:2},E={colspan:"10",class:"text-center"};function H(e,t,l,H,I,A){const M=(0,a.up)("q-input"),Q=(0,a.up)("q-select"),$=(0,a.up)("q-btn"),S=(0,a.up)("q-badge"),j=(0,a.up)("q-chip"),N=(0,a.up)("q-tooltip"),T=(0,a.up)("q-spinner"),F=(0,a.up)("q-markup-table"),B=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(B,{class:"q-pa-md"},{default:(0,a.w5)((()=>[(0,a._)("div",s,[(0,a._)("div",i,[(0,a.Wm)(M,{modelValue:I.filters.from,"onUpdate:modelValue":t[0]||(t[0]=e=>I.filters.from=e),type:"date",label:"Desde (fecha encuesta)",dense:"",outlined:""},null,8,["modelValue"])]),(0,a._)("div",r,[(0,a.Wm)(M,{modelValue:I.filters.to,"onUpdate:modelValue":t[1]||(t[1]=e=>I.filters.to=e),type:"date",label:"Hasta (fecha encuesta)",dense:"",outlined:""},null,8,["modelValue"])]),(0,a._)("div",n,[(0,a.Wm)(M,{modelValue:I.filters.usuario,"onUpdate:modelValue":t[2]||(t[2]=e=>I.filters.usuario=e),dense:"",outlined:"",label:"Usuario (ID o texto)",placeholder:"Ej: 123 o Juan / 123456 / @mail",clearable:""},null,8,["modelValue"])]),(0,a._)("div",c,[(0,a.Wm)(Q,{modelValue:I.filters.score,"onUpdate:modelValue":t[3]||(t[3]=e=>I.filters.score=e),dense:"",outlined:"",clearable:"",label:"Score",options:[{label:"10",value:10},{label:"5",value:5},{label:"0",value:0}],"emit-value":"","map-options":""},null,8,["modelValue"])]),(0,a._)("div",u,[(0,a.Wm)($,{loading:I.loading,color:"primary",icon:"search",label:"Buscar","no-caps":"",class:"full-width",onClick:A.load},null,8,["loading","onClick"])]),(0,a._)("div",d,[(0,a.Wm)($,{color:"negative",icon:"picture_as_pdf",label:"Exportar PDF","no-caps":"",class:"full-width",onClick:A.openPdf,size:"10px",disable:I.loading},null,8,["onClick","disable"]),(0,a.Wm)($,{color:"teal",icon:"grid_on",label:"Exportar Excel","no-caps":"",class:"q-ml-sm full-width",size:"10px",disable:!I.rows.length||I.loading,onClick:A.exportXlsx},null,8,["disable","onClick"])]),(0,a._)("div",_,[(0,a.Wm)(S,{color:"grey-8","text-color":"white",class:"q-pa-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Total: "+(0,o.zw)(I.rows.length),1)])),_:1}),I.rows.length?((0,a.wg)(),(0,a.j4)(S,{key:0,color:"green-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)(" 10: "+(0,o.zw)(I.rows.filter((e=>10===e.score)).length),1)])),_:1})):(0,a.kq)("",!0),I.rows.length?((0,a.wg)(),(0,a.j4)(S,{key:1,color:"amber-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)(" 5: "+(0,o.zw)(I.rows.filter((e=>5===e.score)).length),1)])),_:1})):(0,a.kq)("",!0),I.rows.length?((0,a.wg)(),(0,a.j4)(S,{key:2,color:"red-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)(" 0: "+(0,o.zw)(I.rows.filter((e=>0===e.score)).length),1)])),_:1})):(0,a.kq)("",!0),t[4]||(t[4]=(0,a._)("b",null,"Promedio:",-1)),I.rows.length?((0,a.wg)(),(0,a.j4)(S,{key:3,color:"blue-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)((I.rows.reduce(((e,t)=>e+(t.score||0)),0)/I.rows.length).toFixed(2)),1)])),_:1})):(0,a.kq)("",!0)])]),(0,a.Wm)(F,{flat:"",bordered:"",dense:""},{default:(0,a.w5)((()=>[t[7]||(t[7]=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{class:"text-left"},"#"),(0,a._)("th",{class:"text-left"},"Fecha (encuesta / creación)"),(0,a._)("th",{class:"text-left"},"Cliente"),(0,a._)("th",{class:"text-left"},"Usuario"),(0,a._)("th",{class:"text-left"},"Score"),(0,a._)("th",{class:"text-left"},"Comentario"),(0,a._)("th",{class:"text-left"},"Email"),(0,a._)("th",{class:"text-left"},"IP"),(0,a._)("th",{class:"text-left"},"Host"),(0,a._)("th",{class:"text-left"},"Navegador")])],-1)),!I.loading&&I.rows.length?((0,a.wg)(),(0,a.iD)("tbody",m,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(I.rows,((e,t)=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",p,(0,o.zw)(t+1),1),(0,a._)("td",h,[(0,a._)("div",null,(0,o.zw)(e.encuesta_date||"-"),1),(0,a._)("div",f,(0,o.zw)(A.formatDateTime(e.created_at)),1)]),(0,a._)("td",w,[(0,a._)("div",g,(0,o.zw)(e.cliente_nombre||"-"),1),(0,a._)("div",v," Cod_Aut: "+(0,o.zw)(e.cliente_cod_aut)+" · ID: "+(0,o.zw)(e.cliente_id||"-"),1),(0,a._)("div",b,(0,o.zw)(e.cliente_dir||"-")+" ("+(0,o.zw)(e.cliente_zona||"-")+") ",1)]),(0,a._)("td",x,[(0,a._)("div",k,(0,o.zw)(e.usuario_nombre||"-"),1),(0,a._)("div",y," CodAut: "+(0,o.zw)(e.usuario_cod_aut)+" · CI: "+(0,o.zw)(e.usuario_ci||"-"),1),(0,a._)("div",q,(0,o.zw)(e.usuario_correo||"-"),1)]),(0,a._)("td",z,[(0,a.Wm)(j,{square:"",dense:"","text-color":"white",color:10===e.score?"positive":5===e.score?"amber-7":"negative"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.score),1)])),_:2},1032,["color"])]),(0,a._)("td",D,[(0,a._)("span",null,(0,o.zw)(e.comment||"-"),1)]),(0,a._)("td",C,(0,o.zw)(e.email||"-"),1),(0,a._)("td",U,(0,o.zw)(e.client_ip||"-"),1),(0,a._)("td",Y,[(0,a._)("div",null,(0,o.zw)(e.origin_host||"-"),1),(0,a._)("div",Z,(0,o.zw)(e.origin_scheme||"-")+(0,o.zw)(e.origin_path?" · "+e.origin_path:""),1)]),(0,a._)("td",P,[e.user_agent?((0,a.wg)(),(0,a.j4)(N,{key:0},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.user_agent),1)])),_:2},1024)):(0,a.kq)("",!0),(0,a._)("span",null,(0,o.zw)(A.shortUA(e.user_agent)),1)])])))),128))])):I.loading||I.rows.length?((0,a.wg)(),(0,a.iD)("tbody",W,[(0,a._)("tr",null,[(0,a._)("td",E,[(0,a.Wm)(T,{size:"24px",class:"q-mr-sm"}),t[6]||(t[6]=(0,a.Uk)(" Cargando... ",-1))])])])):((0,a.wg)(),(0,a.iD)("tbody",V,[...t[5]||(t[5]=[(0,a._)("tr",null,[(0,a._)("td",{colspan:"10",class:"text-center text-grey"},"Sin datos para el filtro seleccionado")],-1)])]))])),_:1})])),_:1})}l(66016),l(65363);var I=l(77774),A=l.n(I),M=l(21082);const Q={name:"EncuestaIndex",data(){const e=M.ZP.formatDate(Date.now(),"YYYY-MM-DD");return{loading:!1,rows:[],filters:{from:e,to:e,usuario:"",score:null}}},methods:{formatDateTime(e){return e?M.ZP.formatDate(e,"YYYY-MM-DD HH:mm"):""},shortUA(e){return e?e.length<=48?e:e.slice(0,48)+"…":"-"},async exportXlsx(){try{if(!this.rows.length)return void this.$q.notify({type:"warning",message:"No hay datos para exportar"});const e=this.rows.map(((e,t)=>{var l,a,o,s;return{n:t+1,encuesta_date:e.encuesta_date||"",created_at_fmt:e.created_at?M.ZP.formatDate(e.created_at,"YYYY-MM-DD HH:mm"):"",cliente_nombre:e.cliente_nombre||"",cliente_cod_aut:null!==(l=e.cliente_cod_aut)&&void 0!==l?l:"",cliente_id:null!==(a=e.cliente_id)&&void 0!==a?a:"",cliente_dir:e.cliente_dir||"",cliente_zona:e.cliente_zona||"",usuario_nombre:e.usuario_nombre||"",usuario_cod_aut:null!==(o=e.usuario_cod_aut)&&void 0!==o?o:"",usuario_ci:e.usuario_ci||"",usuario_correo:e.usuario_correo||"",score:null!==(s=e.score)&&void 0!==s?s:"",comment:e.comment||"",email:e.email||"",client_ip:e.client_ip||"",origin_host:e.origin_host||"",origin_scheme:e.origin_scheme||"",origin_path:e.origin_path||"",user_agent:e.user_agent||""}})),t=[{label:"#",value:"n"},{label:"Fecha encuesta",value:"encuesta_date"},{label:"Creado",value:"created_at_fmt"},{label:"Cliente nombre",value:"cliente_nombre"},{label:"Cliente Cod_Aut",value:"cliente_cod_aut"},{label:"Cliente ID",value:"cliente_id"},{label:"Cliente dir",value:"cliente_dir"},{label:"Cliente zona",value:"cliente_zona"},{label:"Usuario nombre",value:"usuario_nombre"},{label:"Usuario CodAut",value:"usuario_cod_aut"},{label:"Usuario CI",value:"usuario_ci"},{label:"Usuario correo",value:"usuario_correo"},{label:"Score",value:"score"},{label:"Comentario",value:"comment"},{label:"Email",value:"email"},{label:"IP",value:"client_ip"},{label:"Host",value:"origin_host"},{label:"Esquema",value:"origin_scheme"},{label:"Path",value:"origin_path"},{label:"Navegador (UA)",value:"user_agent"}],l=[{sheet:"Encuestas",columns:t,content:e}],a=M.ZP.formatDate(Date.now(),"YYYYMMDD_HHmmss"),o={fileName:`reporte-encuestas_${a}`,extraLength:3};A()(l,o)}catch(e){console.error(e),this.$q.notify({type:"negative",message:"No se pudo exportar el Excel"})}},openPdf(){var e,t,l,a;const o=new URLSearchParams({from:this.filters.from||"",to:this.filters.to||"",usuario:this.filters.usuario||"",score:null!==(e=this.filters.score)&&void 0!==e?e:""}),s=(null===(t=this.$api)||void 0===t||null===(l=t.defaults)||void 0===l||null===(a=l.baseURL)||void 0===a?void 0:a.replace(/\/+$/,""))||"http://localhost:8000/api",i=`${s}/encuestas/report-pdf?${o.toString()}`;window.open(i,"_blank")},async load(){this.loading=!0;try{var e,t;const l={from:this.filters.from||void 0,to:this.filters.to||void 0,usuario:this.filters.usuario||void 0,score:null!==(e=this.filters.score)&&void 0!==e?e:void 0,all:1},a=await this.$api.get("encuestas",{params:l});this.rows=Array.isArray(a.data)?a.data:(null===(t=a.data)||void 0===t?void 0:t.data)||[]}catch(l){console.error(l),this.$q.notify({type:"negative",message:"No se pudo cargar encuestas"}),this.rows=[]}finally{this.loading=!1}}},mounted(){this.load()}};var $=l(74260),S=l(24379),j=l(64689),N=l(63314),T=l(2165),F=l(69721),B=l(30481),L=l(67030),R=l(5363),X=l(39754),J=l(7518),K=l.n(J);const G=(0,$.Z)(Q,[["render",H],["__scopeId","data-v-a5dded92"]]),O=G;K()(Q,"components",{QPage:S.Z,QInput:j.Z,QSelect:N.Z,QBtn:T.Z,QBadge:F.Z,QMarkupTable:B.Z,QChip:L.Z,QTooltip:R.Z,QSpinner:X.Z})}}]);