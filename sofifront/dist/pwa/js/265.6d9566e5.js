"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[265],{59265:(e,t,i)=>{i.r(t),i.d(t,{default:()=>T});i(10071);var s=i(83673),a=i(62323),l=i(98880);const o={class:"row items-center no-wrap"},n={class:"col"},r={key:0},u={class:"text-weight-bold"},c={key:1},d={key:0,class:"col-auto"},m={key:0,class:"q-mb-lg"},g={class:"row no-wrap items-center"},h={class:"col-auto q-pr-md column items-center"},p={class:"bar-wrapper"},f={class:"bar-track"},w={class:"col column justify-around q-gutter-md"},v={key:0,class:"q-mt-sm text-center text-positive"},y={class:"q-mt-md"},_={key:0,class:"q-mt-sm text-negative text-caption"};function b(e,t,i,b,k,q){const W=(0,s.up)("q-banner"),x=(0,s.up)("q-btn"),C=(0,s.up)("q-icon"),$=(0,s.up)("q-item-section"),S=(0,s.up)("q-item-label"),I=(0,s.up)("q-item"),U=(0,s.up)("q-input"),Z=(0,s.up)("q-checkbox"),Q=(0,s.up)("q-card"),R=(0,s.up)("q-page"),G=(0,s.up)("q-page-container"),D=(0,s.up)("q-layout"),L=(0,s.Q2)("ripple");return(0,s.wg)(),(0,s.j4)(D,{view:"lhr Lpr lfr",style:{"min-height":"0"}},{default:(0,s.w5)((()=>[(0,s.Wm)(G,null,{default:(0,s.w5)((()=>[(0,s.Wm)(R,{class:"flex flex-center bg-grey-1"},{default:(0,s.w5)((()=>[(0,s.Wm)(Q,{class:"enc-card q-pa-md"},{default:(0,s.w5)((()=>[(0,s.Wm)(W,{class:"q-mb-md bg-grey-2",rounded:"",dense:""},{default:(0,s.w5)((()=>[...t[5]||(t[5]=[(0,s._)("div",{class:"text-body2"},[(0,s._)("b",null,"Encuesta solo para clientes."),(0,s.Uk)(" Tu respuesta es anónima frente al repartidor. Registramos dominio, IP y navegador solo para verificar autenticidad. ")],-1)])])),_:1}),(0,s.Wm)(W,{class:(0,a.C_)(["q-mb-md",k.user?"bg-positive text-white":"bg-grey-2"]),rounded:"",dense:""},{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s._)("div",n,[k.user?((0,s.wg)(),(0,s.iD)("div",r,[t[6]||(t[6]=(0,s.Uk)(" Sesión iniciada como ",-1)),(0,s._)("span",u,(0,a.zw)(k.user.email),1)])):((0,s.wg)(),(0,s.iD)("div",c," (Opcional) Inicia sesión con Google para asociar tu correo "))]),k.user?((0,s.wg)(),(0,s.iD)("div",d,[(0,s.Wm)(x,{dense:"",flat:"",icon:"logout",label:"Salir",onClick:q.logout},null,8,["onClick"])])):(0,s.kq)("",!0)])])),_:1},8,["class"]),k.user?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(x,{class:"btn-google full-width",loading:k.authLoading,onClick:q.loginGoogle,unelevated:""},{default:(0,s.w5)((()=>[...t[7]||(t[7]=[(0,s._)("div",{class:"row items-center no-wrap full-width"},[(0,s._)("img",{class:"g-logo q-mr-sm",alt:"G",src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"}),(0,s._)("div",{class:"col text-center text-weight-medium"},"Continuar con Google")],-1)])])),_:1},8,["loading","onClick"])])),(0,s._)("div",null,[(0,s._)("div",g,[(0,s._)("div",h,[(0,s.Wm)(C,{name:"add",size:"24px",class:"text-positive q-mb-sm"}),(0,s._)("div",p,[(0,s._)("div",f,[(0,s._)("div",{class:"bar-fill",style:(0,a.j5)({height:q.fillHeight+"%",background:"linear-gradient(180deg, #21ba45 0%, #f2c037 50%, #f44336 100%)"})},null,4)]),(0,s._)("div",{class:"bar-tick",style:(0,a.j5)({bottom:q.fillHeight+"%"})},null,4)])]),(0,s._)("div",w,[(0,s.wy)(((0,s.wg)(),(0,s.j4)(I,{clickable:"",onClick:t[0]||(t[0]=e=>q.select(10)),class:"rounded-md"},{default:(0,s.w5)((()=>[(0,s.Wm)($,{avatar:""},{default:(0,s.w5)((()=>[(0,s.Wm)(x,{round:"",unelevated:"",size:"lg",color:q.isSel(10)?"positive":"green-5"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{name:"sentiment_very_satisfied",size:"28px"})])),_:1},8,["color"])])),_:1}),(0,s.Wm)($,null,{default:(0,s.w5)((()=>[(0,s.Wm)(S,{class:"text-weight-bold"},{default:(0,s.w5)((()=>[...t[8]||(t[8]=[(0,s.Uk)("Perfecto!",-1)])])),_:1}),(0,s.Wm)(S,{caption:""},{default:(0,s.w5)((()=>[...t[9]||(t[9]=[(0,s.Uk)("¡Todo excelente!",-1)])])),_:1})])),_:1}),(0,s.Wm)($,{side:""},{default:(0,s.w5)((()=>[...t[10]||(t[10]=[(0,s._)("div",{class:"score text-positive"},"10",-1)])])),_:1})])),_:1})),[[L]]),(0,s.wy)(((0,s.wg)(),(0,s.j4)(I,{clickable:"",onClick:t[1]||(t[1]=e=>q.select(5)),class:"rounded-md"},{default:(0,s.w5)((()=>[(0,s.Wm)($,{avatar:""},{default:(0,s.w5)((()=>[(0,s.Wm)(x,{round:"",unelevated:"",size:"lg",color:q.isSel(5)?"warning":"amber-5"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{name:"sentiment_neutral",size:"28px"})])),_:1},8,["color"])])),_:1}),(0,s.Wm)($,null,{default:(0,s.w5)((()=>[(0,s.Wm)(S,{class:"text-weight-bold"},{default:(0,s.w5)((()=>[...t[11]||(t[11]=[(0,s.Uk)("Bueno",-1)])])),_:1}),(0,s.Wm)(S,{caption:""},{default:(0,s.w5)((()=>[...t[12]||(t[12]=[(0,s.Uk)("Pudo ser mejor",-1)])])),_:1})])),_:1}),(0,s.Wm)($,{side:""},{default:(0,s.w5)((()=>[...t[13]||(t[13]=[(0,s._)("div",{class:"score text-amber-8"},"5",-1)])])),_:1})])),_:1})),[[L]]),(0,s.wy)(((0,s.wg)(),(0,s.j4)(I,{clickable:"",onClick:t[2]||(t[2]=e=>q.select(0)),class:"rounded-md"},{default:(0,s.w5)((()=>[(0,s.Wm)($,{avatar:""},{default:(0,s.w5)((()=>[(0,s.Wm)(x,{round:"",unelevated:"",size:"lg",color:q.isSel(0)?"negative":"red-5"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{name:"sentiment_very_dissatisfied",size:"28px"})])),_:1},8,["color"])])),_:1}),(0,s.Wm)($,null,{default:(0,s.w5)((()=>[(0,s.Wm)(S,{class:"text-weight-bold"},{default:(0,s.w5)((()=>[...t[14]||(t[14]=[(0,s.Uk)("Malo",-1)])])),_:1}),(0,s.Wm)(S,{caption:""},{default:(0,s.w5)((()=>[...t[15]||(t[15]=[(0,s.Uk)("No me gustó",-1)])])),_:1})])),_:1}),(0,s.Wm)($,{side:""},{default:(0,s.w5)((()=>[...t[16]||(t[16]=[(0,s._)("div",{class:"score text-negative"},"0",-1)])])),_:1})])),_:1})),[[L]]),(0,s.Wm)(l.uT,{name:"fade"},{default:(0,s.w5)((()=>[k.sent?((0,s.wg)(),(0,s.iD)("div",v," ¡Gracias por tu respuesta! ✅ ")):(0,s.kq)("",!0)])),_:1})])]),(0,s._)("div",y,[(0,s.Wm)(U,{modelValue:k.comment,"onUpdate:modelValue":t[3]||(t[3]=e=>k.comment=e),type:"textarea",dense:"",autogrow:"",clearable:"",placeholder:"Comentario (opcional)",disable:k.loading},null,8,["modelValue","disable"]),(0,s.Wm)(Z,{modelValue:k.declaroCliente,"onUpdate:modelValue":t[4]||(t[4]=e=>k.declaroCliente=e),disable:k.loading,class:"q-mt-sm",label:"Declaro que soy el cliente titular que recibió el servicio."},null,8,["modelValue","disable"]),(0,s.Wm)(x,{class:"q-mt-sm",color:"primary",label:"Enviar",loading:k.loading,disable:null===k.score||!k.declaroCliente||k.yaRespondio,onClick:q.submit,unelevated:"",rounded:"",icon:"send"},null,8,["loading","disable","onClick"]),k.yaRespondio?((0,s.wg)(),(0,s.iD)("div",_," Ya se registró una respuesta hoy para este cliente y repartidor. ")):(0,s.kq)("",!0)])])])),_:1})])),_:1})])),_:1})])),_:1})}i(92100);const k={name:"EncuestaSatisfaccion",data(){return{idcliente:null,iduser:null,score:null,comment:"",declaroCliente:!1,loading:!1,sent:!1,yaRespondio:!1,user:null,authLoading:!1}},computed:{fillHeight(){return 10===this.score?100:5===this.score?50:(this.score,0)}},async mounted(){if(this.idcliente=Number(this.$route.params.idcliente),this.iduser=Number(this.$route.params.iduser),!this.idcliente||!this.iduser)return void this.$q.notify({type:"negative",message:"URL inválida: faltan parámetros."});const e=localStorage.getItem("enc_user");if(e)try{this.user=JSON.parse(e)}catch(t){}this.$firebase&&(this._unsubAuth=this.$firebase.auth().onAuthStateChanged((async e=>{if(e){const t=await e.getIdToken();this.user={uid:e.uid,email:e.email,name:e.displayName,photo:e.photoURL,idToken:t},localStorage.setItem("enc_user",JSON.stringify(this.user))}else this.user=null,localStorage.removeItem("enc_user")}))),await this.checkDuplicado()},beforeUnmount(){this._unsubAuth&&this._unsubAuth()},methods:{isSel(e){return this.score===e},async select(e){this.score=e},async loginGoogle(){try{if(this.authLoading=!0,this.$loginGoogle)return void await this.$loginGoogle();const e=new this.$firebase.auth.GoogleAuthProvider,t=await this.$firebase.auth().signInWithPopup(e),i=t.user,s=await i.getIdToken();this.user={uid:i.uid,email:i.email,name:i.displayName,photo:i.photoURL,idToken:s},localStorage.setItem("enc_user",JSON.stringify(this.user))}catch(e){console.error(e),this.$q.notify({type:"negative",message:"No se pudo iniciar con Google"})}finally{this.authLoading=!1}},async logout(){try{this.$logout?await this.$logout():await this.$firebase.auth().signOut(),this.user=null,localStorage.removeItem("enc_user")}catch(e){console.error(e)}},async checkDuplicado(){try{const{data:e}=await this.$api.get("encuestas/check",{params:{idcliente:this.idcliente,iduser:this.iduser}});this.yaRespondio=!!e.exists}catch(e){this.$q.notify({type:"warning",message:"No se pudo verificar duplicados."})}},async submit(){if(null!==this.score)if(this.declaroCliente)if(this.yaRespondio)this.$q.notify({type:"negative",message:"Ya existe una respuesta hoy."});else try{var e;this.loading=!0;const t={idcliente:this.idcliente,iduser:this.iduser,score:this.score,comment:this.comment||null,email:(null===(e=this.user)||void 0===e?void 0:e.email)||null,ua:navigator.userAgent};await this.$api.post("encuestas",t),this.sent=!0,this.$q.notify({type:"positive",message:"¡Gracias! Tu respuesta fue enviada."}),this.yaRespondio=!0}catch(s){var t,i;403===(null===s||void 0===s||null===(t=s.response)||void 0===t?void 0:t.status)?this.$q.notify({type:"negative",message:"Solo el cliente puede responder esta encuesta."}):409===(null===s||void 0===s||null===(i=s.response)||void 0===i?void 0:i.status)?(this.$q.notify({type:"warning",message:"Ya se registró una respuesta hoy."}),this.yaRespondio=!0):this.$q.notify({type:"negative",message:"Error al enviar."})}finally{this.loading=!1}else this.$q.notify({type:"warning",message:"Debes declarar que eres el cliente titular."})}}};var q=i(74260),W=i(83066),x=i(72652),C=i(24379),$=i(10151),S=i(15607),I=i(2165),U=i(24554),Z=i(83414),Q=i(52035),R=i(2350),G=i(64689),D=i(65735),L=i(46489),N=i(7518),j=i.n(N);const z=(0,q.Z)(k,[["render",b],["__scopeId","data-v-50dc1749"]]),T=z;j()(k,"components",{QLayout:W.Z,QPageContainer:x.Z,QPage:C.Z,QCard:$.Z,QBanner:S.Z,QBtn:I.Z,QIcon:U.Z,QItem:Z.Z,QItemSection:Q.Z,QItemLabel:R.Z,QInput:G.Z,QCheckbox:D.Z}),j()(k,"directives",{Ripple:L.Z})}}]);