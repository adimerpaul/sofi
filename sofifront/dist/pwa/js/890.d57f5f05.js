"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[890],{57890:(e,t,l)=>{l.r(t),l.d(t,{default:()=>ne});l(10071);var a=l(83673),s=l(62323);const o={class:"row q-col-gutter-md q-mb-md"},r={class:"col-12 col-sm-3"},i={class:"col-12 col-sm-3"},c={class:"col-12 col-sm-3"},n={class:"col-12 col-sm-1"},u={class:"col-12 col-sm-2 flex items-center"},d={class:"col-12 col-sm-2"},m={class:"col-12 q-mt-sm"},_={key:0},g={class:"text-left"},w={class:"text-left"},h={class:"text-caption text-grey-7"},f={class:"text-left"},p={class:"text-weight-medium"},v={class:"text-caption text-grey-7"},b={class:"text-caption ellipsis"},x={class:"text-left"},y={class:"text-weight-medium"},k={class:"text-caption text-grey-7"},q={class:"text-caption"},z={class:"text-left"},U={class:"text-left"},C={class:"text-left"},D={class:"text-left"},W={class:"text-left"},M={class:"text-caption text-grey-7"},Y={class:"text-left"},E={key:1},P={key:2},H={colspan:"10",class:"text-center"},S={class:"q-mt-xl"},Z={class:"badge-row q-mb-md"},A={class:"gauge q-mb-xl"},V={class:"gauge-track"},j=["innerHTML"],I={class:"text-body1 text-weight-medium q-mb-xs"},N={class:"gauge q-mb-sm"},T={class:"gauge-track"},$=["innerHTML"],Q={class:"badge-row"};function L(e,t,l,L,F,R){const B=(0,a.up)("q-input"),K=(0,a.up)("q-select"),X=(0,a.up)("q-btn"),G=(0,a.up)("q-badge"),J=(0,a.up)("q-chip"),O=(0,a.up)("q-tooltip"),ee=(0,a.up)("q-spinner"),te=(0,a.up)("q-markup-table"),le=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(le,{class:"q-pa-md"},{default:(0,a.w5)((()=>[(0,a._)("div",o,[(0,a._)("div",r,[(0,a.Wm)(B,{modelValue:F.filters.from,"onUpdate:modelValue":t[0]||(t[0]=e=>F.filters.from=e),type:"date",label:"Desde (fecha encuesta)",dense:"",outlined:""},null,8,["modelValue"])]),(0,a._)("div",i,[(0,a.Wm)(B,{modelValue:F.filters.to,"onUpdate:modelValue":t[1]||(t[1]=e=>F.filters.to=e),type:"date",label:"Hasta (fecha encuesta)",dense:"",outlined:""},null,8,["modelValue"])]),(0,a._)("div",c,[(0,a.Wm)(B,{modelValue:F.filters.usuario,"onUpdate:modelValue":t[2]||(t[2]=e=>F.filters.usuario=e),dense:"",outlined:"",label:"Usuario (ID o texto)",placeholder:"Ej: 123 o Juan / 123456 / @mail",clearable:""},null,8,["modelValue"])]),(0,a._)("div",n,[(0,a.Wm)(K,{modelValue:F.filters.score,"onUpdate:modelValue":t[3]||(t[3]=e=>F.filters.score=e),dense:"",outlined:"",clearable:"",label:"Score",options:[{label:"10",value:10},{label:"5",value:5},{label:"0",value:0}],"emit-value":"","map-options":""},null,8,["modelValue"])]),(0,a._)("div",u,[(0,a.Wm)(X,{loading:F.loading,color:"primary",icon:"search",label:"Buscar","no-caps":"",class:"full-width",onClick:R.load},null,8,["loading","onClick"])]),(0,a._)("div",d,[(0,a.Wm)(X,{color:"negative",icon:"picture_as_pdf",label:"Exportar PDF","no-caps":"",class:"full-width",onClick:R.openPdf,size:"10px",disable:F.loading},null,8,["onClick","disable"]),(0,a.Wm)(X,{color:"teal",icon:"grid_on",label:"Exportar Excel","no-caps":"",class:"q-ml-sm full-width",size:"10px",disable:!F.rows.length||F.loading,onClick:R.exportXlsx},null,8,["disable","onClick"])]),(0,a._)("div",m,[(0,a.Wm)(G,{color:"grey-8","text-color":"white",class:"q-pa-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Total: "+(0,s.zw)(F.rows.length),1)])),_:1}),F.rows.length?((0,a.wg)(),(0,a.j4)(G,{key:0,color:"green-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)(" 10: "+(0,s.zw)(F.rows.filter((e=>10===e.score)).length),1)])),_:1})):(0,a.kq)("",!0),F.rows.length?((0,a.wg)(),(0,a.j4)(G,{key:1,color:"amber-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)(" 5: "+(0,s.zw)(F.rows.filter((e=>5===e.score)).length),1)])),_:1})):(0,a.kq)("",!0),F.rows.length?((0,a.wg)(),(0,a.j4)(G,{key:2,color:"red-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)(" 0: "+(0,s.zw)(F.rows.filter((e=>0===e.score)).length),1)])),_:1})):(0,a.kq)("",!0),t[4]||(t[4]=(0,a._)("b",null,"Promedio:",-1)),F.rows.length?((0,a.wg)(),(0,a.j4)(G,{key:3,color:"blue-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)((F.rows.reduce(((e,t)=>e+(t.score||0)),0)/F.rows.length).toFixed(2)),1)])),_:1})):(0,a.kq)("",!0)])]),(0,a.Wm)(te,{flat:"",bordered:"",dense:""},{default:(0,a.w5)((()=>[t[7]||(t[7]=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{class:"text-left"},"#"),(0,a._)("th",{class:"text-left"},"Fecha (encuesta / creación)"),(0,a._)("th",{class:"text-left"},"Cliente"),(0,a._)("th",{class:"text-left"},"Usuario"),(0,a._)("th",{class:"text-left"},"Score"),(0,a._)("th",{class:"text-left"},"Comentario"),(0,a._)("th",{class:"text-left"},"Email"),(0,a._)("th",{class:"text-left"},"IP"),(0,a._)("th",{class:"text-left"},"Host"),(0,a._)("th",{class:"text-left"},"Navegador")])],-1)),!F.loading&&F.rows.length?((0,a.wg)(),(0,a.iD)("tbody",_,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(F.rows,((e,t)=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",g,(0,s.zw)(t+1),1),(0,a._)("td",w,[(0,a._)("div",null,(0,s.zw)(e.encuesta_date||"-"),1),(0,a._)("div",h,(0,s.zw)(R.formatDateTime(e.created_at)),1)]),(0,a._)("td",f,[(0,a._)("div",p,(0,s.zw)(e.cliente_nombre||"-"),1),(0,a._)("div",v," Cod_Aut: "+(0,s.zw)(e.cliente_cod_aut)+" · ID: "+(0,s.zw)(e.cliente_id||"-"),1),(0,a._)("div",b,(0,s.zw)(e.cliente_dir||"-")+" ("+(0,s.zw)(e.cliente_zona||"-")+") ",1)]),(0,a._)("td",x,[(0,a._)("div",y,(0,s.zw)(e.usuario_nombre||"-"),1),(0,a._)("div",k," CodAut: "+(0,s.zw)(e.usuario_cod_aut)+" · CI: "+(0,s.zw)(e.usuario_ci||"-"),1),(0,a._)("div",q,(0,s.zw)(e.usuario_correo||"-"),1)]),(0,a._)("td",z,[(0,a.Wm)(J,{square:"",dense:"","text-color":"white",color:10===e.score?"positive":5===e.score?"amber-7":"negative"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.score),1)])),_:2},1032,["color"])]),(0,a._)("td",U,[(0,a._)("span",null,(0,s.zw)(e.comment||"-"),1)]),(0,a._)("td",C,(0,s.zw)(e.email||"-"),1),(0,a._)("td",D,(0,s.zw)(e.client_ip||"-"),1),(0,a._)("td",W,[(0,a._)("div",null,(0,s.zw)(e.origin_host||"-"),1),(0,a._)("div",M,(0,s.zw)(e.origin_scheme||"-")+(0,s.zw)(e.origin_path?" · "+e.origin_path:""),1)]),(0,a._)("td",Y,[e.user_agent?((0,a.wg)(),(0,a.j4)(O,{key:0},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.user_agent),1)])),_:2},1024)):(0,a.kq)("",!0),(0,a._)("span",null,(0,s.zw)(R.shortUA(e.user_agent)),1)])])))),128))])):F.loading||F.rows.length?((0,a.wg)(),(0,a.iD)("tbody",P,[(0,a._)("tr",null,[(0,a._)("td",H,[(0,a.Wm)(ee,{size:"24px",class:"q-mr-sm"}),t[6]||(t[6]=(0,a.Uk)(" Cargando... ",-1))])])])):((0,a.wg)(),(0,a.iD)("tbody",E,[...t[5]||(t[5]=[(0,a._)("tr",null,[(0,a._)("td",{colspan:"10",class:"text-center text-grey"},"Sin datos para el filtro seleccionado")],-1)])]))])),_:1}),(0,a._)("div",S,[t[14]||(t[14]=(0,a._)("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"RESUMEN GENERAL",-1)),(0,a._)("div",Z,[(0,a.Wm)(G,{color:"grey-7","text-color":"white",class:"q-pa-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)("Total: "+(0,s.zw)(R.summary.total),1)])),_:1}),(0,a.Wm)(G,{color:"green-7","text-color":"white",class:"q-pa-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)("10: "+(0,s.zw)(R.summary.c10),1)])),_:1}),(0,a.Wm)(G,{color:"amber-7","text-color":"white",class:"q-pa-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)("5: "+(0,s.zw)(R.summary.c5),1)])),_:1}),(0,a.Wm)(G,{color:"red-7","text-color":"white",class:"q-pa-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)("0: "+(0,s.zw)(R.summary.c0),1)])),_:1}),(0,a.Wm)(G,{color:"blue-7","text-color":"white",class:"q-pa-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)("Promedio: "+(0,s.zw)(R.summary.avg.toFixed(2)),1)])),_:1})]),(0,a._)("div",A,[(0,a._)("div",V,[t[9]||(t[9]=(0,a._)("div",{class:"gauge-end gauge-min"},"–",-1)),t[10]||(t[10]=(0,a._)("div",{class:"gauge-end gauge-max"},"+",-1)),(0,a._)("div",{class:"gauge-thumb",style:(0,s.j5)({left:R.percent(R.summary.avg)+"%"})},[...t[8]||(t[8]=[(0,a._)("div",{class:"gauge-dot"},null,-1)])],4),(0,a._)("div",{class:"gauge-truck",style:(0,s.j5)({left:R.percent(R.summary.avg)+"%"}),innerHTML:R.truckSvg},null,12,j)])]),t[15]||(t[15]=(0,a._)("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"RESUMEN POR CAMIÓN",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(R.byUsuario,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.key,class:"q-mb-lg"},[(0,a._)("div",I,(0,s.zw)(e.nombre),1),(0,a._)("div",N,[(0,a._)("div",T,[t[12]||(t[12]=(0,a._)("div",{class:"gauge-end gauge-min"},"–",-1)),t[13]||(t[13]=(0,a._)("div",{class:"gauge-end gauge-max"},"+",-1)),(0,a._)("div",{class:"gauge-thumb",style:(0,s.j5)({left:R.percent(e.avg)+"%"})},[...t[11]||(t[11]=[(0,a._)("div",{class:"gauge-dot"},null,-1)])],4),(0,a._)("div",{class:"gauge-truck",style:(0,s.j5)({left:R.percent(e.avg)+"%"}),innerHTML:R.truckSvg},null,12,$)])]),(0,a._)("div",Q,[(0,a.Wm)(G,{color:"grey-7","text-color":"white",class:"q-pa-xs"},{default:(0,a.w5)((()=>[(0,a.Uk)("Total: "+(0,s.zw)(e.total),1)])),_:2},1024),(0,a.Wm)(G,{color:"green-7","text-color":"white",class:"q-pa-xs"},{default:(0,a.w5)((()=>[(0,a.Uk)("10: "+(0,s.zw)(e.c10),1)])),_:2},1024),(0,a.Wm)(G,{color:"amber-7","text-color":"white",class:"q-pa-xs"},{default:(0,a.w5)((()=>[(0,a.Uk)("5: "+(0,s.zw)(e.c5),1)])),_:2},1024),(0,a.Wm)(G,{color:"red-7","text-color":"white",class:"q-pa-xs"},{default:(0,a.w5)((()=>[(0,a.Uk)("0: "+(0,s.zw)(e.c0),1)])),_:2},1024),(0,a.Wm)(G,{color:"blue-7","text-color":"white",class:"q-pa-xs"},{default:(0,a.w5)((()=>[(0,a.Uk)("Promedio: "+(0,s.zw)(e.avg.toFixed(2)),1)])),_:2},1024)])])))),128))])])),_:1})}l(66016),l(65363);var F=l(77774),R=l.n(F),B=l(21082);const K={name:"EncuestaIndex",data(){const e=B.ZP.formatDate(Date.now(),"YYYY-MM-DD");return{loading:!1,rows:[],filters:{from:e,to:e,usuario:"",score:null}}},computed:{summary(){const e=this.rows.length,t=this.rows.filter((e=>10===e.score)).length,l=this.rows.filter((e=>5===e.score)).length,a=this.rows.filter((e=>0===e.score)).length,s=this.rows.reduce(((e,t)=>e+(t.score||0)),0),o=e?s/e:0;return{total:e,c10:t,c5:l,c0:a,avg:o}},byUsuario(){const e=new Map;for(const o of this.rows){var t,l;const s=(null!==(t=null!==(l=o.usuario_cod_aut)&&void 0!==l?l:o.usuario_nombre)&&void 0!==t?t:"Sin usuario")+"";var a;if(!e.has(s))e.set(s,{key:s,nombre:o.usuario_nombre||`CodAut ${null!==(a=o.usuario_cod_aut)&&void 0!==a?a:""}`,total:0,c10:0,c5:0,c0:0,sum:0});const r=e.get(s);r.total+=1,10===o.score?r.c10+=1:5===o.score?r.c5+=1:0===o.score&&(r.c0+=1),r.sum+=o.score||0}const s=Array.from(e.values()).map((e=>({...e,avg:e.total?e.sum/e.total:0})));return s.sort(((e,t)=>e.nombre.localeCompare(t.nombre)))},truckSvg(){return'\n      <svg width="70" height="36" viewBox="0 0 70 36" xmlns="http://www.w3.org/2000/svg">\n        <rect x="2" y="10" width="34" height="16" rx="2" fill="#e0e0e0" stroke="#9e9e9e"/>\n        <rect x="36" y="14" width="15" height="12" rx="2" fill="#eeeeee" stroke="#9e9e9e"/>\n        <polygon points="55,26 65,26 67,22 57,22" fill="#e53935"/>\n        <circle cx="18" cy="30" r="4.5" fill="#212121"/>\n        <circle cx="18" cy="30" r="2.2" fill="#bdbdbd"/>\n        <circle cx="50" cy="30" r="4.5" fill="#212121"/>\n        <circle cx="50" cy="30" r="2.2" fill="#bdbdbd"/>\n      </svg>'}},methods:{percent(e){const t=10*(Number(e)||0);return Math.max(0,Math.min(100,t))},formatDateTime(e){return e?B.ZP.formatDate(e,"YYYY-MM-DD HH:mm"):""},shortUA(e){return e?e.length<=48?e:e.slice(0,48)+"…":"-"},async exportXlsx(){try{if(!this.rows.length)return void this.$q.notify({type:"warning",message:"No hay datos para exportar"});const e=this.rows.map(((e,t)=>{var l,a,s,o;return{n:t+1,encuesta_date:e.encuesta_date||"",created_at_fmt:e.created_at?B.ZP.formatDate(e.created_at,"YYYY-MM-DD HH:mm"):"",cliente_nombre:e.cliente_nombre||"",cliente_cod_aut:null!==(l=e.cliente_cod_aut)&&void 0!==l?l:"",cliente_id:null!==(a=e.cliente_id)&&void 0!==a?a:"",cliente_dir:e.cliente_dir||"",cliente_zona:e.cliente_zona||"",usuario_nombre:e.usuario_nombre||"",usuario_cod_aut:null!==(s=e.usuario_cod_aut)&&void 0!==s?s:"",usuario_ci:e.usuario_ci||"",usuario_correo:e.usuario_correo||"",score:null!==(o=e.score)&&void 0!==o?o:"",comment:e.comment||"",email:e.email||"",client_ip:e.client_ip||"",origin_host:e.origin_host||"",origin_scheme:e.origin_scheme||"",origin_path:e.origin_path||"",user_agent:e.user_agent||""}})),t=[{label:"#",value:"n"},{label:"Fecha encuesta",value:"encuesta_date"},{label:"Creado",value:"created_at_fmt"},{label:"Cliente nombre",value:"cliente_nombre"},{label:"Cliente Cod_Aut",value:"cliente_cod_aut"},{label:"Cliente ID",value:"cliente_id"},{label:"Cliente dir",value:"cliente_dir"},{label:"Cliente zona",value:"cliente_zona"},{label:"Usuario nombre",value:"usuario_nombre"},{label:"Usuario CodAut",value:"usuario_cod_aut"},{label:"Usuario CI",value:"usuario_ci"},{label:"Usuario correo",value:"usuario_correo"},{label:"Score",value:"score"},{label:"Comentario",value:"comment"},{label:"Email",value:"email"},{label:"IP",value:"client_ip"},{label:"Host",value:"origin_host"},{label:"Esquema",value:"origin_scheme"},{label:"Path",value:"origin_path"},{label:"Navegador (UA)",value:"user_agent"}],l=[{sheet:"Encuestas",columns:t,content:e}],a=B.ZP.formatDate(Date.now(),"YYYYMMDD_HHmmss"),s={fileName:`reporte-encuestas_${a}`,extraLength:3};R()(l,s)}catch(e){console.error(e),this.$q.notify({type:"negative",message:"No se pudo exportar el Excel"})}},openPdf(){var e,t,l,a;const s=new URLSearchParams({from:this.filters.from||"",to:this.filters.to||"",usuario:this.filters.usuario||"",score:null!==(e=this.filters.score)&&void 0!==e?e:""}),o=(null===(t=this.$api)||void 0===t||null===(l=t.defaults)||void 0===l||null===(a=l.baseURL)||void 0===a?void 0:a.replace(/\/+$/,""))||"http://localhost:8000/api",r=`${o}/encuestas/report-pdf?${s.toString()}`;window.open(r,"_blank")},async load(){this.loading=!0;try{var e,t;const l={from:this.filters.from||void 0,to:this.filters.to||void 0,usuario:this.filters.usuario||void 0,score:null!==(e=this.filters.score)&&void 0!==e?e:void 0,all:1},a=await this.$api.get("encuestas",{params:l});this.rows=Array.isArray(a.data)?a.data:(null===(t=a.data)||void 0===t?void 0:t.data)||[]}catch(l){console.error(l),this.$q.notify({type:"negative",message:"No se pudo cargar encuestas"}),this.rows=[]}finally{this.loading=!1}}},mounted(){this.load()}};var X=l(74260),G=l(24379),J=l(64689),O=l(63314),ee=l(2165),te=l(69721),le=l(30481),ae=l(67030),se=l(5363),oe=l(39754),re=l(7518),ie=l.n(re);const ce=(0,X.Z)(K,[["render",L],["__scopeId","data-v-25f7df38"]]),ne=ce;ie()(K,"components",{QPage:G.Z,QInput:J.Z,QSelect:O.Z,QBtn:ee.Z,QBadge:te.Z,QMarkupTable:le.Z,QChip:ae.Z,QTooltip:se.Z,QSpinner:oe.Z})}}]);