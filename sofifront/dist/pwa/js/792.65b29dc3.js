"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[792],{79792:(e,l,t)=>{t.r(l),t.d(l,{default:()=>P});t(10071);var i=t(83673),o=t(62323);const a={class:"row q-col-gutter-md"},s={class:"col-12 col-md-5"},n={class:"q-mt-sm row justify-between items-center"},c={class:"text-caption"},d={key:0,class:"col-12 col-md-7"},r={class:"text-h6"},p={key:0,class:"row q-col-gutter-sm"},m={class:"text-caption ellipsis"},u={class:"row justify-end"},f={class:"row q-col-gutter-sm q-mt-xs"},g={key:0,class:"col-12"};function h(e,l,t,h,w,_){const v=(0,i.up)("q-space"),C=(0,i.up)("q-icon"),b=(0,i.up)("q-input"),y=(0,i.up)("q-card-section"),W=(0,i.up)("q-separator"),q=(0,i.up)("q-btn"),k=(0,i.up)("q-td"),F=(0,i.up)("q-table"),x=(0,i.up)("q-card"),S=(0,i.up)("q-banner"),Z=(0,i.up)("q-file"),Q=(0,i.up)("q-img"),I=(0,i.up)("q-item-section"),U=(0,i.up)("q-item"),$=(0,i.up)("q-card-actions"),A=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(A,{class:"q-pa-md"},{default:(0,i.w5)((()=>[(0,i._)("div",a,[(0,i._)("div",s,[(0,i.Wm)(x,{flat:"",bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{class:"row items-center"},{default:(0,i.w5)((()=>[l[6]||(l[6]=(0,i._)("div",{class:"text-h6"},"Clientes",-1)),(0,i.Wm)(v),(0,i.Wm)(b,{dense:"",outlined:"",debounce:"350",modelValue:w.search,"onUpdate:modelValue":[l[0]||(l[0]=e=>w.search=e),l[1]||(l[1]=e=>{w.page=1,_.fetchClientes()})],placeholder:"Buscar por nombre, Cod_Aut o CI",class:"q-ml-sm"},{append:(0,i.w5)((()=>[(0,i.Wm)(C,{name:"search"})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(W),(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Wm)(F,{rows:w.clientes,columns:w.colsClientes,"row-key":"Cod_Aut",flat:"",bordered:"",dense:"","hide-bottom":"",loading:w.loadingClientes,"rows-per-page-options":[0]},{"body-cell-opciones":(0,i.w5)((e=>[(0,i.Wm)(k,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(q,{size:"sm",color:"primary",icon:"photo",label:"Fotos",onClick:l=>_.selectCliente(e.row)},null,8,["onClick"])])),_:2},1032,["props"])])),_:1},8,["rows","columns","loading"]),(0,i._)("div",n,[(0,i.Wm)(q,{dense:"",flat:"",icon:"chevron_left",disable:!w.pagination.prev,onClick:l[2]||(l[2]=e=>_.goPage("prev"))},null,8,["disable"]),(0,i._)("div",c,"Página "+(0,o.zw)(w.page),1),(0,i.Wm)(q,{dense:"",flat:"",icon:"chevron_right",disable:!w.pagination.next,onClick:l[3]||(l[3]=e=>_.goPage("next"))},null,8,["disable"])])])),_:1})])),_:1})]),w.clienteSel?((0,i.wg)(),(0,i.iD)("div",d,[(0,i.Wm)(x,{flat:"",bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{class:"row items-center"},{default:(0,i.w5)((()=>[(0,i._)("div",r," Fotos — #"+(0,o.zw)(w.clienteSel.Cod_Aut)+" · "+(0,o.zw)(w.clienteSel.Nombres),1),(0,i.Wm)(v),(0,i.Wm)(q,{flat:"",dense:"",icon:"refresh",onClick:_.fetchFotos,loading:w.loadingFotos},null,8,["onClick","loading"])])),_:1}),(0,i.Wm)(W),(0,i.Wm)(y,{class:"q-gutter-md"},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{class:"bg-grey-2 text-dark"},{default:(0,i.w5)((()=>[...l[7]||(l[7]=[(0,i.Uk)(" Sube una o varias imágenes. Se comprimen en el servidor (JPG 85%, máx 1600px). ",-1)])])),_:1}),(0,i.Wm)(Z,{ref:"qfile",modelValue:w.files,"onUpdate:modelValue":l[5]||(l[5]=e=>w.files=e),multiple:"","use-chips":"",outlined:"",clearable:"",accept:"image/*",counter:"","max-file-size":5242880,label:"Seleccionar imágenes (máx 5MB c/u)"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(C,{name:"photo_camera"})])),append:(0,i.w5)((()=>[(0,i.Wm)(q,{flat:"",dense:"",icon:"folder_open",onClick:l[4]||(l[4]=l=>e.$refs.qfile.pickFiles())})])),_:1},8,["modelValue"]),w.files.length?((0,i.wg)(),(0,i.iD)("div",p,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(w.files,((e,l)=>((0,i.wg)(),(0,i.iD)("div",{key:l,class:"col-6 col-sm-4 col-md-3"},[(0,i.Wm)(x,{flat:"",bordered:"",class:"overflow-hidden"},{default:(0,i.w5)((()=>[(0,i.Wm)(Q,{src:_.fileUrl(e),ratio:1},null,8,["src"]),(0,i.Wm)(U,{dense:"",class:"q-pa-xs"},{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[(0,i._)("div",m,(0,o.zw)(e.name),1)])),_:2},1024),(0,i.Wm)(I,{side:""},{default:(0,i.w5)((()=>[(0,i.Wm)(q,{flat:"",dense:"",round:"",icon:"close",onClick:e=>_.removeTemp(l)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])))),128))])):(0,i.kq)("",!0),(0,i._)("div",u,[(0,i.Wm)(q,{color:"primary",icon:"cloud_upload",label:"Subir",disable:0===w.files.length,loading:w.loadingUpload,onClick:_.upload},null,8,["disable","loading","onClick"])]),(0,i.Wm)(W),l[9]||(l[9]=(0,i._)("div",{class:"text-subtitle2"},"Galería",-1)),(0,i._)("div",f,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(w.fotos,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,class:"col-6 col-sm-4 col-md-3"},[(0,i.Wm)(x,{flat:"",bordered:"",class:"overflow-hidden"},{default:(0,i.w5)((()=>[(0,i.Wm)(Q,{src:e.url,ratio:1,"spinner-color":"primary"},null,8,["src"]),(0,i.Wm)($,{align:"between"},{default:(0,i.w5)((()=>[(0,i.Wm)(q,{dense:"",flat:"",icon:"open_in_new",onClick:l=>_.openFull(e.url)},null,8,["onClick"]),(0,i.Wm)(q,{dense:"",flat:"",color:"negative",icon:"delete",loading:w.removingId===e.id,onClick:l=>_.removeFoto(e.id)},null,8,["loading","onClick"])])),_:2},1024)])),_:2},1024)])))),128)),w.loadingFotos||0!==w.fotos.length?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",g,[(0,i.Wm)(S,{class:"bg-grey-2 text-grey-8"},{default:(0,i.w5)((()=>[...l[8]||(l[8]=[(0,i.Uk)(" Aún no hay fotos para este cliente. ",-1)])])),_:1})]))])])),_:1})])),_:1})])):(0,i.kq)("",!0)])])),_:1})}t(17965),t(66016);const w={name:"ClienteFotografias",data(){return{search:"",clientes:[],loadingClientes:!1,page:1,pagination:{next:null,prev:null},clienteSel:null,fotos:[],loadingFotos:!1,loadingUpload:!1,removingId:null,files:[],colsClientes:[{label:"Opciones",name:"opciones",field:"opciones",align:"left"},{label:"Cod",name:"Cod_Aut",field:"Cod_Aut",align:"left"},{label:"Nombre",name:"Nombres",field:"Nombres",align:"left"},{label:"CI",name:"Id",field:"Id",align:"left"},{label:"Tel",name:"Telf",field:"Telf",align:"left"}]}},created(){this.fetchClientes()},methods:{async fetchClientes(){this.loadingClientes=!0;try{const{data:e}=await this.$api.get("cliente-photos",{params:{search:this.search,page:this.page}});this.clientes=e.data||[],this.pagination.next=e.next_page_url,this.pagination.prev=e.prev_page_url}finally{this.loadingClientes=!1}},goPage(e){"next"===e&&this.pagination.next?(this.page+=1,this.fetchClientes()):"prev"===e&&this.pagination.prev&&this.page>1&&(this.page-=1,this.fetchClientes())},selectCliente(e){this.clienteSel=e,this.fetchFotos()},async fetchFotos(){if(this.clienteSel){this.loadingFotos=!0;try{const{data:e}=await this.$api.get("cliente-photos",{params:{cliente_id:this.clienteSel.Cod_Aut}});this.fotos=e}finally{this.loadingFotos=!1}}},fileUrl(e){return URL.createObjectURL(e)},removeTemp(e){this.files.splice(e,1)},async upload(){if(this.clienteSel&&0!==this.files.length){this.loadingUpload=!0;try{const e=new FormData;e.append("cliente_id",this.clienteSel.Cod_Aut),this.files.forEach((l=>e.append("photos[]",l))),await this.$api.post("cliente-photos",e,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Fotos subidas"}),this.files=[],await this.fetchFotos()}catch(t){var e,l;this.$q.notify({type:"negative",message:(null===t||void 0===t||null===(e=t.response)||void 0===e||null===(l=e.data)||void 0===l?void 0:l.message)||"Error al subir"})}finally{this.loadingUpload=!1}}},async removeFoto(e){this.removingId=e;try{await this.$api.delete(`cliente-photos/${e}`),this.fotos=this.fotos.filter((l=>l.id!==e)),this.$q.notify({type:"positive",message:"Foto eliminada"})}catch(l){this.$q.notify({type:"negative",message:"No se pudo eliminar"})}finally{this.removingId=null}},openFull(e){window.open(e,"_blank")}}};var _=t(74260),v=t(24379),C=t(10151),b=t(25589),y=t(62025),W=t(64689),q=t(24554),k=t(65869),F=t(55242),x=t(83884),S=t(2165),Z=t(15607),Q=t(81052),I=t(24027),U=t(83414),$=t(52035),A=t(99367),D=t(7518),T=t.n(D);const z=(0,_.Z)(w,[["render",h]]),P=z;T()(w,"components",{QPage:v.Z,QCard:C.Z,QCardSection:b.Z,QSpace:y.Z,QInput:W.Z,QIcon:q.Z,QSeparator:k.Z,QTable:F.Z,QTd:x.Z,QBtn:S.Z,QBanner:Z.Z,QFile:Q.Z,QImg:I.Z,QItem:U.Z,QItemSection:$.Z,QCardActions:A.Z})}}]);