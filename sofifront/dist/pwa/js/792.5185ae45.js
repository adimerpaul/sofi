"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[792],{79792:(e,l,t)=>{t.r(l),t.d(l,{default:()=>B});var i=t(83673),o=t(62323);const a={class:"row q-col-gutter-md"},s={class:"col-12 col-md-5"},n=(0,i._)("div",{class:"text-h6"},"Clientes",-1),c={class:"q-mt-sm row justify-between items-center"},d={class:"text-caption"},r={key:0,class:"col-12 col-md-7"},p={class:"text-h6"},m=(0,i.Uk)(" Sube una o varias imágenes. Se comprimen en el servidor (JPG 85%, máx 1600px). "),u={key:0,class:"row q-col-gutter-sm"},f={class:"text-caption ellipsis"},g={class:"row justify-end"},h=(0,i._)("div",{class:"text-subtitle2"},"Galería",-1),w={class:"row q-col-gutter-sm q-mt-xs"},_={key:0,class:"col-12"},v=(0,i.Uk)(" Aún no hay fotos para este cliente. ");function C(e,l,t,C,b,y){const W=(0,i.up)("q-space"),q=(0,i.up)("q-icon"),k=(0,i.up)("q-input"),F=(0,i.up)("q-card-section"),x=(0,i.up)("q-separator"),S=(0,i.up)("q-btn"),Z=(0,i.up)("q-td"),Q=(0,i.up)("q-table"),I=(0,i.up)("q-card"),U=(0,i.up)("q-banner"),$=(0,i.up)("q-file"),A=(0,i.up)("q-img"),D=(0,i.up)("q-item-section"),T=(0,i.up)("q-item"),z=(0,i.up)("q-card-actions"),P=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(P,{class:"q-pa-md"},{default:(0,i.w5)((()=>[(0,i._)("div",a,[(0,i._)("div",s,[(0,i.Wm)(I,{flat:"",bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{class:"row items-center"},{default:(0,i.w5)((()=>[n,(0,i.Wm)(W),(0,i.Wm)(k,{dense:"",outlined:"",debounce:"350",modelValue:b.search,"onUpdate:modelValue":[l[0]||(l[0]=e=>b.search=e),l[1]||(l[1]=e=>{b.page=1,y.fetchClientes()})],placeholder:"Buscar por nombre, Cod_Aut o CI",class:"q-ml-sm"},{append:(0,i.w5)((()=>[(0,i.Wm)(q,{name:"search"})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(x),(0,i.Wm)(F,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Q,{rows:b.clientes,columns:b.colsClientes,"row-key":"Cod_Aut",flat:"",bordered:"",dense:"","hide-bottom":"",loading:b.loadingClientes,"rows-per-page-options":[0]},{"body-cell-opciones":(0,i.w5)((e=>[(0,i.Wm)(Z,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{size:"sm",color:"primary",icon:"photo",label:"Fotos",onClick:l=>y.selectCliente(e.row)},null,8,["onClick"])])),_:2},1032,["props"])])),_:1},8,["rows","columns","loading"]),(0,i._)("div",c,[(0,i.Wm)(S,{dense:"",flat:"",icon:"chevron_left",disable:!b.pagination.prev,onClick:l[2]||(l[2]=e=>y.goPage("prev"))},null,8,["disable"]),(0,i._)("div",d,"Página "+(0,o.zw)(b.page),1),(0,i.Wm)(S,{dense:"",flat:"",icon:"chevron_right",disable:!b.pagination.next,onClick:l[3]||(l[3]=e=>y.goPage("next"))},null,8,["disable"])])])),_:1})])),_:1})]),b.clienteSel?((0,i.wg)(),(0,i.iD)("div",r,[(0,i.Wm)(I,{flat:"",bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{class:"row items-center"},{default:(0,i.w5)((()=>[(0,i._)("div",p," Fotos — #"+(0,o.zw)(b.clienteSel.Cod_Aut)+" · "+(0,o.zw)(b.clienteSel.Nombres),1),(0,i.Wm)(W),(0,i.Wm)(S,{flat:"",dense:"",icon:"refresh",onClick:y.fetchFotos,loading:b.loadingFotos},null,8,["onClick","loading"])])),_:1}),(0,i.Wm)(x),(0,i.Wm)(F,{class:"q-gutter-md"},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{class:"bg-grey-2 text-dark"},{default:(0,i.w5)((()=>[m])),_:1}),(0,i.Wm)($,{ref:"qfile",modelValue:b.files,"onUpdate:modelValue":l[5]||(l[5]=e=>b.files=e),multiple:"","use-chips":"",outlined:"",clearable:"",accept:"image/*",counter:"","max-file-size":5242880,label:"Seleccionar imágenes (máx 5MB c/u)"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(q,{name:"photo_camera"})])),append:(0,i.w5)((()=>[(0,i.Wm)(S,{flat:"",dense:"",icon:"folder_open",onClick:l[4]||(l[4]=l=>e.$refs.qfile.pickFiles())})])),_:1},8,["modelValue"]),b.files.length?((0,i.wg)(),(0,i.iD)("div",u,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(b.files,((e,l)=>((0,i.wg)(),(0,i.iD)("div",{key:l,class:"col-6 col-sm-4 col-md-3"},[(0,i.Wm)(I,{flat:"",bordered:"",class:"overflow-hidden"},{default:(0,i.w5)((()=>[(0,i.Wm)(A,{src:y.fileUrl(e),ratio:1},null,8,["src"]),(0,i.Wm)(T,{dense:"",class:"q-pa-xs"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,null,{default:(0,i.w5)((()=>[(0,i._)("div",f,(0,o.zw)(e.name),1)])),_:2},1024),(0,i.Wm)(D,{side:""},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{flat:"",dense:"",round:"",icon:"close",onClick:e=>y.removeTemp(l)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])))),128))])):(0,i.kq)("",!0),(0,i._)("div",g,[(0,i.Wm)(S,{color:"primary",icon:"cloud_upload",label:"Subir",disable:0===b.files.length,loading:b.loadingUpload,onClick:y.upload},null,8,["disable","loading","onClick"])]),(0,i.Wm)(x),h,(0,i._)("div",w,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(b.fotos,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,class:"col-6 col-sm-4 col-md-3"},[(0,i.Wm)(I,{flat:"",bordered:"",class:"overflow-hidden"},{default:(0,i.w5)((()=>[(0,i.Wm)(A,{src:e.url,ratio:1,"spinner-color":"primary"},null,8,["src"]),(0,i.Wm)(z,{align:"between"},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{dense:"",flat:"",icon:"open_in_new",onClick:l=>y.openFull(e.url)},null,8,["onClick"]),(0,i.Wm)(S,{dense:"",flat:"",color:"negative",icon:"delete",loading:b.removingId===e.id,onClick:l=>y.removeFoto(e.id)},null,8,["loading","onClick"])])),_:2},1024)])),_:2},1024)])))),128)),b.loadingFotos||0!==b.fotos.length?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",_,[(0,i.Wm)(U,{class:"bg-grey-2 text-grey-8"},{default:(0,i.w5)((()=>[v])),_:1})]))])])),_:1})])),_:1})])):(0,i.kq)("",!0)])])),_:1})}t(10071),t(17965),t(66016);const b={name:"ClienteFotografias",data(){return{search:"",clientes:[],loadingClientes:!1,page:1,pagination:{next:null,prev:null},clienteSel:null,fotos:[],loadingFotos:!1,loadingUpload:!1,removingId:null,files:[],colsClientes:[{label:"Opciones",name:"opciones",field:"opciones",align:"left"},{label:"Cod",name:"Cod_Aut",field:"Cod_Aut",align:"left"},{label:"Nombre",name:"Nombres",field:"Nombres",align:"left"},{label:"CI",name:"Id",field:"Id",align:"left"},{label:"Tel",name:"Telf",field:"Telf",align:"left"}]}},created(){this.fetchClientes()},methods:{async fetchClientes(){this.loadingClientes=!0;try{const{data:e}=await this.$api.get("cliente-photos",{params:{search:this.search,page:this.page}});this.clientes=e.data||[],this.pagination.next=e.next_page_url,this.pagination.prev=e.prev_page_url}finally{this.loadingClientes=!1}},goPage(e){"next"===e&&this.pagination.next?(this.page+=1,this.fetchClientes()):"prev"===e&&this.pagination.prev&&this.page>1&&(this.page-=1,this.fetchClientes())},selectCliente(e){this.clienteSel=e,this.fetchFotos()},async fetchFotos(){if(this.clienteSel){this.loadingFotos=!0;try{const{data:e}=await this.$api.get("cliente-photos",{params:{cliente_id:this.clienteSel.Cod_Aut}});this.fotos=e}finally{this.loadingFotos=!1}}},fileUrl(e){return URL.createObjectURL(e)},removeTemp(e){this.files.splice(e,1)},async upload(){if(this.clienteSel&&0!==this.files.length){this.loadingUpload=!0;try{const e=new FormData;e.append("cliente_id",this.clienteSel.Cod_Aut),this.files.forEach((l=>e.append("photos[]",l))),await this.$api.post("cliente-photos",e,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Fotos subidas"}),this.files=[],await this.fetchFotos()}catch(t){var e,l;this.$q.notify({type:"negative",message:(null===t||void 0===t||null===(e=t.response)||void 0===e||null===(l=e.data)||void 0===l?void 0:l.message)||"Error al subir"})}finally{this.loadingUpload=!1}}},async removeFoto(e){this.removingId=e;try{await this.$api.delete(`cliente-photos/${e}`),this.fotos=this.fotos.filter((l=>l.id!==e)),this.$q.notify({type:"positive",message:"Foto eliminada"})}catch(l){this.$q.notify({type:"negative",message:"No se pudo eliminar"})}finally{this.removingId=null}},openFull(e){window.open(e,"_blank")}}};var y=t(74260),W=t(24379),q=t(10151),k=t(25589),F=t(62025),x=t(64689),S=t(24554),Z=t(65869),Q=t(55242),I=t(83884),U=t(2165),$=t(15607),A=t(81052),D=t(24027),T=t(83414),z=t(52035),P=t(99367),V=t(7518),N=t.n(V);const j=(0,y.Z)(b,[["render",C]]),B=j;N()(b,"components",{QPage:W.Z,QCard:q.Z,QCardSection:k.Z,QSpace:F.Z,QInput:x.Z,QIcon:S.Z,QSeparator:Z.Z,QTable:Q.Z,QTd:I.Z,QBtn:U.Z,QBanner:$.Z,QFile:A.Z,QImg:D.Z,QItem:T.Z,QItemSection:z.Z,QCardActions:P.Z})}}]);