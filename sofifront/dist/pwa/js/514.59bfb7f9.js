"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[514],{62514:(e,l,o)=>{o.r(l),o.d(l,{default:()=>Q});var d=o(83673),t=o(62323),i=o(98880);const a={class:"row"},n={class:"col-12 col-md-3"},s={class:"col-12 col-md-3"},r={class:"col-12 col-md-2 text-center"},u={class:"col-12 col-md-4"},c=["onClick"],p={style:{"max-width":"80px","wrap-option":"wrap"}},v={class:"absolute-full flex flex-center"},m={class:"absolute-full flex flex-center"},h={class:"absolute-full flex flex-center"},g={class:"text-bold text-right"},f={class:"col-12 col-md-8"},b={style:{height:"350px",width:"100%"}},_={class:"col-12 q-mt-md"},w={key:1,class:"text-positive"};function C(e,l,o,C,x,k){const y=(0,d.up)("q-input"),z=(0,d.up)("q-select"),D=(0,d.up)("q-btn"),W=(0,d.up)("q-badge"),L=(0,d.up)("q-linear-progress"),q=(0,d.up)("q-markup-table"),M=(0,d.up)("LTileLayer"),E=(0,d.up)("l-tooltip"),O=(0,d.up)("l-icon"),V=(0,d.up)("l-marker"),N=(0,d.up)("l-map"),P=(0,d.up)("q-card-section"),T=(0,d.up)("q-card"),Z=(0,d.up)("q-page");return(0,d.wg)(),(0,d.j4)(Z,{class:"bg-grey-3 q-pa-xs"},{default:(0,d.w5)((()=>[(0,d.Wm)(T,{flat:"",bordered:""},{default:(0,d.w5)((()=>[(0,d.Wm)(P,null,{default:(0,d.w5)((()=>[(0,d._)("div",a,[(0,d._)("div",n,[(0,d.Wm)(y,{modelValue:x.fecha,"onUpdate:modelValue":l[0]||(l[0]=e=>x.fecha=e),label:"Fecha",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),(0,d._)("div",s,[(0,d.Wm)(z,{modelValue:x.tipo,"onUpdate:modelValue":l[1]||(l[1]=e=>x.tipo=e),label:"Tipo",dense:"",outlined:"",options:x.tipos,"emit-value":"","map-options":""},null,8,["modelValue","options"])]),(0,d._)("div",r,[(0,d.Wm)(D,{label:"Buscar",color:"primary",dense:"",onClick:k.buscar,icon:"search","no-caps":"",loading:x.loading},null,8,["onClick","loading"])]),l[8]||(l[8]=(0,d._)("div",{class:"col-12"},null,-1)),(0,d._)("div",u,[(0,d.Wm)(q,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:(0,d.w5)((()=>[l[5]||(l[5]=(0,d._)("thead",null,[(0,d._)("tr",null,[(0,d._)("th",null,"#"),(0,d._)("th",null,"Pedidos"),(0,d._)("th",null,"Cantidades")])],-1)),(0,d._)("tbody",null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(x.pedidos.users,((l,o)=>((0,d.wg)(),(0,d.iD)("tr",{key:o,onClick:e=>k.seleccionar(l)},[(0,d._)("td",null,(0,t.zw)(o+1),1),(0,d._)("td",null,[l.pedidos.creados>0?((0,d.wg)(),(0,d.j4)(D,{key:0,class:"q-mr-sm",color:"orange",size:"xs",icon:"send",label:"Enviar emegencia",loading:x.loading,dense:"","no-caps":"",onClick:(0,i.iM)((e=>k.enviarPedidosEmergencia(l)),["stop"])},null,8,["loading","onClick"])):(0,d.kq)("",!0),(0,d._)("div",p,(0,t.zw)(e.$filters.capitalize(l.nombreCompleto)),1)]),(0,d._)("td",null,[(0,d.Wm)(L,{size:"20px",value:1,color:"accent"},{default:(0,d.w5)((()=>[(0,d._)("div",v,[(0,d.Wm)(W,{color:"white","text-color":"black",label:"Total "+l.pedidos.cantidad},null,8,["label"])])])),_:2},1024),(0,d.Wm)(L,{size:"20px",value:l.pedidos.creados/l.pedidos.cantidad,color:"blue"},{default:(0,d.w5)((()=>[(0,d._)("div",m,[(0,d.Wm)(W,{color:"white","text-color":"black",label:"Creados "+l.pedidos.creados},null,8,["label"])])])),_:2},1032,["value"]),(0,d.Wm)(L,{size:"20px",value:l.pedidos.enviados/l.pedidos.cantidad,color:"green"},{default:(0,d.w5)((()=>[(0,d._)("div",h,[(0,d.Wm)(W,{color:"white","text-color":"black",label:"Enviados "+l.pedidos.enviados},null,8,["label"])])])),_:2},1032,["value"])])],8,c)))),128))]),(0,d._)("tfoot",null,[(0,d._)("tr",null,[l[3]||(l[3]=(0,d._)("td",null,null,-1)),l[4]||(l[4]=(0,d._)("td",{class:"text-right text-bold"},"Total",-1)),(0,d._)("td",g,(0,t.zw)(k.total),1)])])])),_:1})]),(0,d._)("div",f,[(0,d._)("div",b,[(0,d.Wm)(N,{modelValue:x.zoom,"onUpdate:modelValue":l[2]||(l[2]=e=>x.zoom=e),zoom:x.zoom,center:x.center},{default:(0,d.w5)((()=>{var e;return[(0,d.Wm)(M,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(null===(e=x.pedidosMapa)||void 0===e?void 0:e.users,(e=>{var l;return(0,d.wg)(),(0,d.iD)(d.HY,null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(null===e||void 0===e||null===(l=e.pedidos)||void 0===l?void 0:l.pedidos.filter((e=>{var l,o,d,t;return(null===(l=e.pedido)||void 0===l||null===(o=l.cliente)||void 0===o?void 0:o.Latitud)&&(null===(d=e.pedido)||void 0===d||null===(t=d.cliente)||void 0===t?void 0:t.longitud)})),((e,l)=>((0,d.wg)(),(0,d.j4)(V,{key:l,"lat-lng":[parseFloat(e.pedido.cliente.Latitud),parseFloat(e.pedido.cliente.longitud)]},{default:(0,d.w5)((()=>[(0,d.Wm)(E,{content:e.pedido.cliente.Nombres},null,8,["content"]),(0,d.Wm)(O,null,{default:(0,d.w5)((()=>[(0,d.Wm)(W,{style:{padding:"2px"},color:"CREADO"===e.pedido.estado?"blue":"green"},{default:(0,d.w5)((()=>[(0,d.Uk)((0,t.zw)(e.pedido.idCli),1)])),_:2},1032,["color"])])),_:2},1024)])),_:2},1032,["lat-lng"])))),128))],64)})),256))]})),_:1},8,["modelValue","zoom","center"])])]),(0,d._)("div",_,[(0,d.Wm)(T,{flat:"",bordered:""},{default:(0,d.w5)((()=>[(0,d.Wm)(P,null,{default:(0,d.w5)((()=>[l[7]||(l[7]=(0,d._)("div",{class:"text-bold"},"Clientes con coordenadas faltantes",-1)),k.pedidosInvalidos.length>0?((0,d.wg)(),(0,d.j4)(q,{key:0,flat:"",dense:"",bordered:""},{default:(0,d.w5)((()=>[l[6]||(l[6]=(0,d._)("thead",null,[(0,d._)("tr",null,[(0,d._)("th",null,"#"),(0,d._)("th",null,"Cliente"),(0,d._)("th",null,"ID Cliente"),(0,d._)("th",null,"Vendedor")])],-1)),(0,d._)("tbody",null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(k.pedidosInvalidos,((e,l)=>((0,d.wg)(),(0,d.iD)("tr",{key:l},[(0,d._)("td",null,(0,t.zw)(l+1),1),(0,d._)("td",null,(0,t.zw)(e.NroPed)+" "+(0,t.zw)(e.nombre),1),(0,d._)("td",null,(0,t.zw)(e.idCli),1),(0,d._)("td",null,(0,t.zw)(e.vendedor),1)])))),128))])])),_:1})):((0,d.wg)(),(0,d.iD)("div",w," Todos los pedidos tienen coordenadas. "))])),_:1})])),_:1})])])])),_:1})])),_:1})])),_:1})}o(19544),o(10071);var x=o(11488),k=o.n(x),y=o(8892);const z={name:"MapaVendedor",components:{LMap:y.iA,LIcon:y.QC,LTileLayer:y.Hw,LMarker:y.$R,LTooltip:y.Gs},data(){return{center:[-17.969721,-67.114493],zoom:13,fecha:k()().format("YYYY-MM-DD"),loading:!1,pedidos:[],pedidosAll:[],pedidosMapa:[],tipos:[{label:"TODOS",value:""},{label:"CERDO",value:"CERDO"},{label:"EMBUTIDO",value:"NORMAL"},{label:"POLLO",value:"POLLO"},{label:"RES",value:"RES"}],tipo:""}},mounted(){this.buscar()},methods:{toFloatOrZero(e){const l=parseFloat(e);return isNaN(l)||!isFinite(l)?0:l},enviarPedidosEmergencia(e){this.loading=!0,this.$api.post("enviarPedidosEmergencia",{user:e.CodAut,fecha:this.fecha}).then((e=>{const l=e.data.pedidosCondeuda;let o="";for(let d=0;d<l.length;d++)o+=`<div> DEUDA ${d+1}.- ${l[d].Nombres} <br> ${l[d].Telf} <br> ${l[d].Direccion}</div>`;this.$q.notify({type:"positive",message:'Se enviaron los pedidos de emergencia <br> <div style="max-height: 200px; overflow-y: auto;">'+o+"</div>",position:"top",html:!0}),this.buscar()})).catch((e=>{this.$q.notify({type:"negative",message:e.response.data.message})})).finally((()=>{this.loading=!1}))},seleccionar(e){this.pedidosMapa.users=this.pedidosAll.users.filter((l=>l.CodAut===e.CodAut))},buscar(){this.loading=!0,this.$api.post("mapaVendedor",{fecha:this.fecha,tipo:this.tipo}).then((e=>{console.log(e.data),this.pedidos=e.data,this.pedidosMapa={...e.data},this.pedidosAll={...e.data}})).finally((()=>{this.loading=!1}))}},computed:{pedidosInvalidos(){const e=[];for(const t of(null===(l=this.pedidosMapa)||void 0===l?void 0:l.users)||[]){var l;for(const l of(null===t||void 0===t||null===(o=t.pedidos)||void 0===o?void 0:o.pedidos)||[]){var o,d;const i=null===l||void 0===l||null===(d=l.pedido)||void 0===d?void 0:d.cliente;i&&i.Latitud&&i.longitud||e.push({NroPed:l.pedido.NroPed,nombre:(null===i||void 0===i?void 0:i.Nombres)||"SIN NOMBRE",idCli:l.pedido.idCli,vendedor:t.nombreCompleto})}}return e},total(){let e=0;for(let d=0;d<(null===(l=this.pedidos)||void 0===l||null===(o=l.users)||void 0===o?void 0:o.length);d++){var l,o;e+=this.pedidos.users[d].pedidos.cantidad}return e}}};var D=o(74260),W=o(24379),L=o(10151),q=o(25589),M=o(64689),E=o(63314),O=o(2165),V=o(30481),N=o(51598),P=o(69721),T=o(7518),Z=o.n(T);const A=(0,D.Z)(z,[["render",C]]),Q=A;Z()(z,"components",{QPage:W.Z,QCard:L.Z,QCardSection:q.Z,QInput:M.Z,QSelect:E.Z,QBtn:O.Z,QMarkupTable:V.Z,QLinearProgress:N.Z,QBadge:P.Z})}}]);