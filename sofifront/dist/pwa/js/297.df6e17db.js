"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[297],{87297:(e,t,l)=>{l.r(t),l.d(t,{default:()=>G});l(10071);var s=l(83673),a=l(62323);const o={class:"row q-col-gutter-md q-mb-md"},i={class:"col-12 col-sm-3"},r={class:"col-12 col-sm-3"},c={class:"col-12 col-sm-3"},n={class:"col-12 col-sm-1"},d={class:"col-12 col-sm-2 flex items-center"},u={class:"col-12 col-sm-2 flex items-center"},m={class:"col-12 q-mt-sm"},_={key:0},f={class:"text-left"},w={class:"text-left"},p={class:"text-caption text-grey-7"},h={class:"text-left"},g={class:"text-weight-medium"},x={class:"text-caption text-grey-7"},v={class:"text-caption ellipsis"},b={class:"text-left"},k={class:"text-weight-medium"},q={class:"text-caption text-grey-7"},z={class:"text-caption"},y={class:"text-left"},D={class:"text-left"},U={class:"text-left"},C={class:"text-left"},V={class:"text-left"},Z={class:"text-caption text-grey-7"},W={class:"text-left"},P={key:1},Q={key:2},Y={colspan:"10",class:"text-center"};function j(e,t,l,j,I,S){const A=(0,s.up)("q-input"),$=(0,s.up)("q-select"),H=(0,s.up)("q-btn"),M=(0,s.up)("q-badge"),T=(0,s.up)("q-chip"),E=(0,s.up)("q-tooltip"),B=(0,s.up)("q-spinner"),F=(0,s.up)("q-markup-table"),L=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(L,{class:"q-pa-md"},{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s._)("div",i,[(0,s.Wm)(A,{modelValue:I.filters.from,"onUpdate:modelValue":t[0]||(t[0]=e=>I.filters.from=e),type:"date",label:"Desde (fecha encuesta)",dense:"",outlined:""},null,8,["modelValue"])]),(0,s._)("div",r,[(0,s.Wm)(A,{modelValue:I.filters.to,"onUpdate:modelValue":t[1]||(t[1]=e=>I.filters.to=e),type:"date",label:"Hasta (fecha encuesta)",dense:"",outlined:""},null,8,["modelValue"])]),(0,s._)("div",c,[(0,s.Wm)(A,{modelValue:I.filters.usuario,"onUpdate:modelValue":t[2]||(t[2]=e=>I.filters.usuario=e),dense:"",outlined:"",label:"Usuario (ID o texto)",placeholder:"Ej: 123 o Juan / 123456 / @mail",clearable:""},null,8,["modelValue"])]),(0,s._)("div",n,[(0,s.Wm)($,{modelValue:I.filters.score,"onUpdate:modelValue":t[3]||(t[3]=e=>I.filters.score=e),dense:"",outlined:"",clearable:"",label:"Score",options:[{label:"10",value:10},{label:"5",value:5},{label:"0",value:0}],"emit-value":"","map-options":""},null,8,["modelValue"])]),(0,s._)("div",d,[(0,s.Wm)(H,{loading:I.loading,color:"primary",icon:"search",label:"Buscar","no-caps":"",class:"full-width",onClick:S.load},null,8,["loading","onClick"])]),(0,s._)("div",u,[(0,s.Wm)(H,{color:"negative",icon:"picture_as_pdf",label:"Exportar PDF","no-caps":"",class:"full-width",onClick:S.openPdf,size:"10px",disable:I.loading},null,8,["onClick","disable"])]),(0,s._)("div",m,[(0,s.Wm)(M,{color:"grey-8","text-color":"white",class:"q-pa-sm"},{default:(0,s.w5)((()=>[(0,s.Uk)(" Total: "+(0,a.zw)(I.rows.length),1)])),_:1}),I.rows.length?((0,s.wg)(),(0,s.j4)(M,{key:0,color:"green-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,s.w5)((()=>[(0,s.Uk)(" 10: "+(0,a.zw)(I.rows.filter((e=>10===e.score)).length),1)])),_:1})):(0,s.kq)("",!0),I.rows.length?((0,s.wg)(),(0,s.j4)(M,{key:1,color:"amber-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,s.w5)((()=>[(0,s.Uk)(" 5: "+(0,a.zw)(I.rows.filter((e=>5===e.score)).length),1)])),_:1})):(0,s.kq)("",!0),I.rows.length?((0,s.wg)(),(0,s.j4)(M,{key:2,color:"red-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,s.w5)((()=>[(0,s.Uk)(" 0: "+(0,a.zw)(I.rows.filter((e=>0===e.score)).length),1)])),_:1})):(0,s.kq)("",!0),t[4]||(t[4]=(0,s._)("b",null,"Promedio:",-1)),I.rows.length?((0,s.wg)(),(0,s.j4)(M,{key:3,color:"blue-7","text-color":"white",class:"q-pa-sm q-ml-sm"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)((I.rows.reduce(((e,t)=>e+(t.score||0)),0)/I.rows.length).toFixed(2)),1)])),_:1})):(0,s.kq)("",!0)])]),(0,s.Wm)(F,{flat:"",bordered:"",dense:""},{default:(0,s.w5)((()=>[t[7]||(t[7]=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",{class:"text-left"},"#"),(0,s._)("th",{class:"text-left"},"Fecha (encuesta / creación)"),(0,s._)("th",{class:"text-left"},"Cliente"),(0,s._)("th",{class:"text-left"},"Usuario"),(0,s._)("th",{class:"text-left"},"Score"),(0,s._)("th",{class:"text-left"},"Comentario"),(0,s._)("th",{class:"text-left"},"Email"),(0,s._)("th",{class:"text-left"},"IP"),(0,s._)("th",{class:"text-left"},"Host"),(0,s._)("th",{class:"text-left"},"Navegador")])],-1)),!I.loading&&I.rows.length?((0,s.wg)(),(0,s.iD)("tbody",_,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(I.rows,((e,t)=>((0,s.wg)(),(0,s.iD)("tr",{key:e.id},[(0,s._)("td",f,(0,a.zw)(t+1),1),(0,s._)("td",w,[(0,s._)("div",null,(0,a.zw)(e.encuesta_date||"-"),1),(0,s._)("div",p,(0,a.zw)(S.formatDateTime(e.created_at)),1)]),(0,s._)("td",h,[(0,s._)("div",g,(0,a.zw)(e.cliente_nombre||"-"),1),(0,s._)("div",x," Cod_Aut: "+(0,a.zw)(e.cliente_cod_aut)+" · ID: "+(0,a.zw)(e.cliente_id||"-"),1),(0,s._)("div",v,(0,a.zw)(e.cliente_dir||"-")+" ("+(0,a.zw)(e.cliente_zona||"-")+") ",1)]),(0,s._)("td",b,[(0,s._)("div",k,(0,a.zw)(e.usuario_nombre||"-"),1),(0,s._)("div",q," CodAut: "+(0,a.zw)(e.usuario_cod_aut)+" · CI: "+(0,a.zw)(e.usuario_ci||"-"),1),(0,s._)("div",z,(0,a.zw)(e.usuario_correo||"-"),1)]),(0,s._)("td",y,[(0,s.Wm)(T,{square:"",dense:"","text-color":"white",color:10===e.score?"positive":5===e.score?"amber-7":"negative"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.score),1)])),_:2},1032,["color"])]),(0,s._)("td",D,[(0,s._)("span",null,(0,a.zw)(e.comment||"-"),1)]),(0,s._)("td",U,(0,a.zw)(e.email||"-"),1),(0,s._)("td",C,(0,a.zw)(e.client_ip||"-"),1),(0,s._)("td",V,[(0,s._)("div",null,(0,a.zw)(e.origin_host||"-"),1),(0,s._)("div",Z,(0,a.zw)(e.origin_scheme||"-")+(0,a.zw)(e.origin_path?" · "+e.origin_path:""),1)]),(0,s._)("td",W,[e.user_agent?((0,s.wg)(),(0,s.j4)(E,{key:0},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.user_agent),1)])),_:2},1024)):(0,s.kq)("",!0),(0,s._)("span",null,(0,a.zw)(S.shortUA(e.user_agent)),1)])])))),128))])):I.loading||I.rows.length?((0,s.wg)(),(0,s.iD)("tbody",Q,[(0,s._)("tr",null,[(0,s._)("td",Y,[(0,s.Wm)(B,{size:"24px",class:"q-mr-sm"}),t[6]||(t[6]=(0,s.Uk)(" Cargando... ",-1))])])])):((0,s.wg)(),(0,s.iD)("tbody",P,[...t[5]||(t[5]=[(0,s._)("tr",null,[(0,s._)("td",{colspan:"10",class:"text-center text-grey"},"Sin datos para el filtro seleccionado")],-1)])]))])),_:1})])),_:1})}l(66016),l(65363);var I=l(21082);const S={name:"EncuestaIndex",data(){const e=I.ZP.formatDate(Date.now(),"YYYY-MM-DD");return{loading:!1,rows:[],filters:{from:e,to:e,usuario:"",score:null}}},methods:{formatDateTime(e){return e?I.ZP.formatDate(e,"YYYY-MM-DD HH:mm"):""},shortUA(e){return e?e.length<=48?e:e.slice(0,48)+"…":"-"},openPdf(){var e,t,l,s;const a=new URLSearchParams({from:this.filters.from||"",to:this.filters.to||"",usuario:this.filters.usuario||"",score:null!==(e=this.filters.score)&&void 0!==e?e:""}),o=(null===(t=this.$api)||void 0===t||null===(l=t.defaults)||void 0===l||null===(s=l.baseURL)||void 0===s?void 0:s.replace(/\/+$/,""))||"http://localhost:8000/api",i=`${o}/encuestas/report-pdf?${a.toString()}`;window.open(i,"_blank")},async load(){this.loading=!0;try{var e,t;const l={from:this.filters.from||void 0,to:this.filters.to||void 0,usuario:this.filters.usuario||void 0,score:null!==(e=this.filters.score)&&void 0!==e?e:void 0,all:1},s=await this.$api.get("encuestas",{params:l});this.rows=Array.isArray(s.data)?s.data:(null===(t=s.data)||void 0===t?void 0:t.data)||[]}catch(l){console.error(l),this.$q.notify({type:"negative",message:"No se pudo cargar encuestas"}),this.rows=[]}finally{this.loading=!1}}},mounted(){this.load()}};var A=l(74260),$=l(24379),H=l(64689),M=l(63314),T=l(2165),E=l(69721),B=l(30481),F=l(67030),L=l(5363),N=l(39754),R=l(7518),J=l.n(R);const K=(0,A.Z)(S,[["render",j],["__scopeId","data-v-1b9de8be"]]),G=K;J()(S,"components",{QPage:$.Z,QInput:H.Z,QSelect:M.Z,QBtn:T.Z,QBadge:E.Z,QMarkupTable:B.Z,QChip:F.Z,QTooltip:L.Z,QSpinner:N.Z})}}]);