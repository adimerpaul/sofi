"use strict";(self["webpackChunksofi"]=self["webpackChunksofi"]||[]).push([[809],{58809:(e,l,o)=>{o.r(l),o.d(l,{default:()=>H});var d=o(83673),t=o(62323),i=o(98880);const a={class:"row"},n={class:"col-12 col-md-3"},s={class:"col-12 col-md-3"},u={class:"col-12 col-md-2 text-center"},r=(0,d._)("div",{class:"col-12"},null,-1),c={class:"col-12 col-md-4"},p=(0,d._)("thead",null,[(0,d._)("tr",null,[(0,d._)("th",null,"#"),(0,d._)("th",null,"Pedidos"),(0,d._)("th",null,"Cantidades")])],-1),v=["onClick"],m={style:{"max-width":"80px","wrap-option":"wrap"}},h={class:"absolute-full flex flex-center"},f={class:"absolute-full flex flex-center"},g={class:"absolute-full flex flex-center"},b=(0,d._)("td",null,null,-1),_=(0,d._)("td",{class:"text-right text-bold"},"Total",-1),w={class:"text-bold text-right"},C={class:"col-12 col-md-8"},x={style:{height:"350px",width:"100%"}},k={class:"col-12 q-mt-md"},y=(0,d._)("div",{class:"text-bold"},"Clientes con coordenadas faltantes",-1),z=(0,d._)("thead",null,[(0,d._)("tr",null,[(0,d._)("th",null,"#"),(0,d._)("th",null,"Cliente"),(0,d._)("th",null,"ID Cliente"),(0,d._)("th",null,"Vendedor")])],-1),D={key:1,class:"text-positive"};function W(e,l,o,W,L,q){const M=(0,d.up)("q-input"),E=(0,d.up)("q-select"),O=(0,d.up)("q-btn"),V=(0,d.up)("q-badge"),P=(0,d.up)("q-linear-progress"),T=(0,d.up)("q-markup-table"),A=(0,d.up)("LTileLayer"),Q=(0,d.up)("l-tooltip"),Z=(0,d.up)("l-icon"),$=(0,d.up)("l-marker"),N=(0,d.up)("l-map"),Y=(0,d.up)("q-card-section"),I=(0,d.up)("q-card"),R=(0,d.up)("q-page");return(0,d.wg)(),(0,d.j4)(R,{class:"bg-grey-3 q-pa-xs"},{default:(0,d.w5)((()=>[(0,d.Wm)(I,{flat:"",bordered:""},{default:(0,d.w5)((()=>[(0,d.Wm)(Y,null,{default:(0,d.w5)((()=>[(0,d._)("div",a,[(0,d._)("div",n,[(0,d.Wm)(M,{modelValue:L.fecha,"onUpdate:modelValue":l[0]||(l[0]=e=>L.fecha=e),label:"Fecha",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),(0,d._)("div",s,[(0,d.Wm)(E,{modelValue:L.tipo,"onUpdate:modelValue":l[1]||(l[1]=e=>L.tipo=e),label:"Tipo",dense:"",outlined:"",options:L.tipos,"emit-value":"","map-options":""},null,8,["modelValue","options"])]),(0,d._)("div",u,[(0,d.Wm)(O,{label:"Buscar",color:"primary",dense:"",onClick:q.buscar,icon:"search","no-caps":"",loading:L.loading},null,8,["onClick","loading"])]),r,(0,d._)("div",c,[(0,d.Wm)(T,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:(0,d.w5)((()=>[p,(0,d._)("tbody",null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(L.pedidos.users,((l,o)=>((0,d.wg)(),(0,d.iD)("tr",{key:o,onClick:e=>q.seleccionar(l)},[(0,d._)("td",null,(0,t.zw)(o+1),1),(0,d._)("td",null,[l.pedidos.creados>0?((0,d.wg)(),(0,d.j4)(O,{key:0,class:"q-mr-sm",color:"orange",size:"xs",icon:"send",label:"Enviar emegencia",loading:L.loading,dense:"","no-caps":"",onClick:(0,i.iM)((e=>q.enviarPedidosEmergencia(l)),["stop"])},null,8,["loading","onClick"])):(0,d.kq)("",!0),(0,d._)("div",m,(0,t.zw)(e.$filters.capitalize(l.nombreCompleto)),1)]),(0,d._)("td",null,[(0,d.Wm)(P,{size:"20px",value:1,color:"accent"},{default:(0,d.w5)((()=>[(0,d._)("div",h,[(0,d.Wm)(V,{color:"white","text-color":"black",label:"Total "+l.pedidos.cantidad},null,8,["label"])])])),_:2},1024),(0,d.Wm)(P,{size:"20px",value:l.pedidos.creados/l.pedidos.cantidad,color:"blue"},{default:(0,d.w5)((()=>[(0,d._)("div",f,[(0,d.Wm)(V,{color:"white","text-color":"black",label:"Creados "+l.pedidos.creados},null,8,["label"])])])),_:2},1032,["value"]),(0,d.Wm)(P,{size:"20px",value:l.pedidos.enviados/l.pedidos.cantidad,color:"green"},{default:(0,d.w5)((()=>[(0,d._)("div",g,[(0,d.Wm)(V,{color:"white","text-color":"black",label:"Enviados "+l.pedidos.enviados},null,8,["label"])])])),_:2},1032,["value"])])],8,v)))),128))]),(0,d._)("tfoot",null,[(0,d._)("tr",null,[b,_,(0,d._)("td",w,(0,t.zw)(q.total),1)])])])),_:1})]),(0,d._)("div",C,[(0,d._)("div",x,[(0,d.Wm)(N,{modelValue:L.zoom,"onUpdate:modelValue":l[2]||(l[2]=e=>L.zoom=e),zoom:L.zoom,center:L.center},{default:(0,d.w5)((()=>{var e;return[(0,d.Wm)(A,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(null===(e=L.pedidosMapa)||void 0===e?void 0:e.users,(e=>{var l;return(0,d.wg)(),(0,d.iD)(d.HY,null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(null===e||void 0===e||null===(l=e.pedidos)||void 0===l?void 0:l.pedidos.filter((e=>{var l,o,d,t;return(null===(l=e.pedido)||void 0===l||null===(o=l.cliente)||void 0===o?void 0:o.Latitud)&&(null===(d=e.pedido)||void 0===d||null===(t=d.cliente)||void 0===t?void 0:t.longitud)})),((e,l)=>((0,d.wg)(),(0,d.j4)($,{key:l,"lat-lng":[parseFloat(e.pedido.cliente.Latitud),parseFloat(e.pedido.cliente.longitud)]},{default:(0,d.w5)((()=>[(0,d.Wm)(Q,{content:e.pedido.cliente.Nombres},null,8,["content"]),(0,d.Wm)(Z,null,{default:(0,d.w5)((()=>[(0,d.Wm)(V,{style:{padding:"2px"},color:"CREADO"===e.pedido.estado?"blue":"green"},{default:(0,d.w5)((()=>[(0,d.Uk)((0,t.zw)(e.pedido.idCli),1)])),_:2},1032,["color"])])),_:2},1024)])),_:2},1032,["lat-lng"])))),128))],64)})),256))]})),_:1},8,["modelValue","zoom","center"])])]),(0,d._)("div",k,[(0,d.Wm)(I,{flat:"",bordered:""},{default:(0,d.w5)((()=>[(0,d.Wm)(Y,null,{default:(0,d.w5)((()=>[y,q.pedidosInvalidos.length>0?((0,d.wg)(),(0,d.j4)(T,{key:0,flat:"",dense:"",bordered:""},{default:(0,d.w5)((()=>[z,(0,d._)("tbody",null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(q.pedidosInvalidos,((e,l)=>((0,d.wg)(),(0,d.iD)("tr",{key:l},[(0,d._)("td",null,(0,t.zw)(l+1),1),(0,d._)("td",null,(0,t.zw)(e.NroPed)+" "+(0,t.zw)(e.nombre),1),(0,d._)("td",null,(0,t.zw)(e.idCli),1),(0,d._)("td",null,(0,t.zw)(e.vendedor),1)])))),128))])])),_:1})):((0,d.wg)(),(0,d.iD)("div",D," Todos los pedidos tienen coordenadas. "))])),_:1})])),_:1})])])])),_:1})])),_:1})])),_:1})}o(19544),o(10071);var L=o(11488),q=o.n(L),M=o(8892);const E={name:"MapaVendedor",components:{LMap:M.iA,LIcon:M.QC,LTileLayer:M.Hw,LMarker:M.$R,LTooltip:M.Gs},data(){return{center:[-17.969721,-67.114493],zoom:13,fecha:q()().format("YYYY-MM-DD"),loading:!1,pedidos:[],pedidosAll:[],pedidosMapa:[],tipos:[{label:"TODOS",value:""},{label:"CERDO",value:"CERDO"},{label:"EMBUTIDO",value:"NORMAL"},{label:"POLLO",value:"POLLO"},{label:"RES",value:"RES"}],tipo:""}},mounted(){this.buscar()},methods:{enviarPedidosEmergencia(e){this.loading=!0,this.$api.post("enviarPedidosEmergencia",{user:e.CodAut,fecha:this.fecha}).then((e=>{const l=e.data.pedidosCondeuda;let o="";for(let d=0;d<l.length;d++)o+=`<div> DEUDA ${d+1}.- ${l[d].Nombres} <br> ${l[d].Telf} <br> ${l[d].Direccion}</div>`;this.$q.notify({type:"positive",message:'Se enviaron los pedidos de emergencia <br> <div style="max-height: 200px; overflow-y: auto;">'+o+"</div>",position:"top",html:!0}),this.buscar()})).catch((e=>{this.$q.notify({type:"negative",message:e.response.data.message})})).finally((()=>{this.loading=!1}))},seleccionar(e){this.pedidosMapa.users=this.pedidosAll.users.filter((l=>l.CodAut===e.CodAut))},buscar(){this.loading=!0,this.$api.post("mapaVendedor",{fecha:this.fecha,tipo:this.tipo}).then((e=>{this.pedidos=e.data,this.pedidosMapa={...e.data},this.pedidosAll={...e.data}})).finally((()=>{this.loading=!1}))}},computed:{pedidosInvalidos(){const e=[];for(const t of(null===(l=this.pedidosMapa)||void 0===l?void 0:l.users)||[]){var l;for(const l of(null===t||void 0===t||null===(o=t.pedidos)||void 0===o?void 0:o.pedidos)||[]){var o,d;const i=null===l||void 0===l||null===(d=l.pedido)||void 0===d?void 0:d.cliente;i&&i.Latitud&&i.longitud||e.push({NroPed:l.pedido.NroPed,nombre:(null===i||void 0===i?void 0:i.Nombres)||"SIN NOMBRE",idCli:l.pedido.idCli,vendedor:t.nombreCompleto})}}return e},total(){let e=0;for(let d=0;d<(null===(l=this.pedidos)||void 0===l||null===(o=l.users)||void 0===o?void 0:o.length);d++){var l,o;e+=this.pedidos.users[d].pedidos.cantidad}return e}}};var O=o(74260),V=o(24379),P=o(10151),T=o(25589),A=o(64689),Q=o(63314),Z=o(2165),$=o(30481),N=o(51598),Y=o(69721),I=o(7518),R=o.n(I);const S=(0,O.Z)(E,[["render",W]]),H=S;R()(E,"components",{QPage:V.Z,QCard:P.Z,QCardSection:T.Z,QInput:A.Z,QSelect:Q.Z,QBtn:Z.Z,QMarkupTable:$.Z,QLinearProgress:N.Z,QBadge:Y.Z})}}]);